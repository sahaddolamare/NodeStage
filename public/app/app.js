angular.module("stage",["ngResource","ngRoute","ui.gravatar","ngAnimate"]),angular.module("stage").config(["$routeProvider","$locationProvider",function(e,r){var t={admin:{auth:["stAuthSvc",function(e){return e.authorizeCurrentUserForRoute("admin")}]},user:{auth:["stAuthSvc",function(e){return e.authorizeAuthenticatedUserForRoute()}]},guest:{auth:["stAuthSvc",function(e){return e.unauthenticatedUser()}]}};r.html5Mode(!0),e.when("/",{templateUrl:"/partials/main/main",controller:"stMainCtrl"}).when("/admin",{templateUrl:"/partials/admin/views/admin",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/ddb",{templateUrl:"/partials/admin/views/dev-dashboard",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/add",{templateUrl:"/partials/admin/views/add-user",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/delete",{templateUrl:"/partials/admin/views/delete-user",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/purge",{templateUrl:"/partials/admin/views/purge-users",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/sync",{templateUrl:"/partials/admin/views/sync-users",controller:"stAdminCtrl",resolve:t.admin}).when("/login",{templateUrl:"/partials/account/views/login",controller:"stLoginCtrl",resolve:t.guest}).when("/signup",{templateUrl:"/partials/account/views/signup",controller:"stSignupCtrl",resolve:t.guest}).when("/settings",{templateUrl:"/partials/account/views/settings",controller:"stProfileCtrl",resolve:t.user}).otherwise({redirectTo:"/"})}]),angular.module("stage").run(["$rootScope","$location",function(e,r){e.$on("$routeChangeError",function(e,t,n,s){"not authorized"===s&&r.path("/")})}]),angular.module("stage").factory("stAuthSvc",["$http","$q","stIdentitySvc","stUserSvc",function(e,r,t,n){return{authenticateUser:function(s,a){var o=r.defer();return e.post("/login",{username:s,password:a}).then(function(e){if(e.data.success){var r=new n;delete e.data.user.hashed_pwd,delete e.data.user.salt,angular.extend(r,e.data.user),t.currentUser=r,o.resolve(!0)}else o.resolve(!1)}),o.promise},createUser:function(e){var t=new n(e),s=r.defer();return t.$save().then(function(){s.resolve()},function(e){s.reject(e.data.reason)}),s.promise},logoutUser:function(){var n=r.defer();return e.post("/logout",{logout:!0}).then(function(){t.currentUser=void 0,n.resolve()}),n.promise},purgeUsers:function(){var t=r.defer();return e({method:"PURGE",url:"/api/users"}).then(function(){console.log("User database has been purged"),t.resolve()}),t.promise},syncUsers:function(t){var n=r.defer();return e({method:"COPY",url:"/api/db",headers:{"Content-Type":"application/json"},data:{collection:"users",direction:t}}).then(function(){console.log("User database has been synced"),n.resolve()}),n.promise},updateCurrentUser:function(e){var n=r.defer(),s=angular.copy(t.currentUser);return angular.extend(s,e),s.$update().then(function(){t.currentUser=s,n.resolve()},function(e){n.reject(e.data.reason)}),n.promise},authorizeAuthenticatedUserForRoute:function(){return t.isAuthenticated()?!0:r.reject("not authorized")},authorizeCurrentUserForRoute:function(e){return t.isAuthorized(e)?!0:r.reject("not authorized")},unauthenticatedUser:function(){return t.isAuthenticated()?r.reject("user signed in"):!0}}}]),angular.module("stage").factory("stIdentitySvc",["$window","stUserSvc",function(e,r){var t;return e.stageUser&&(t=new r,delete e.stageUser.hashed_pwd,delete e.stageUser.salt,angular.extend(t,e.stageUser)),{currentUser:t,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(e){return!!this.currentUser&&this.currentUser.roles.indexOf(e)>-1}}}]),angular.module("stage").controller("stLoginCtrl",["$scope","$location","stAuthSvc","stIdentitySvc","stTickerSvc",function(e,r,t,n,s){e.identity=n,e.signin=function(a,o){return!a||!o||a.$invalid||o.$invalid?(a&&!a.$invalid||$(loginWidget.username).addClass("invalid"),o&&!o.$invalid||$(loginWidget.password).addClass("invalid"),s.error("Please enter a valid email address and password."),!1):void t.authenticateUser(a,o).then(function(t){if(t){a="",o="",e.username="",e.password="";var i=n.isAuthorized("admin")?"/admin":"/";s.notify("You have been successfully authenticated."),r.path("login")&&r.path(i),n.isAuthorized("admin")&&r.path(i)}else s.error("Invalid email address or password was given.")})},e.signout=function(){t.logoutUser().then(function(){e.username="",e.password="",s.notify("You have been signed out."),r.path("/")})}}]),angular.module("stage").directive("stLoginWidget",function(){return{restrict:"E",replace:!0,templateUrl:"/partials/account/views/login-widget"}}),angular.module("stage").controller("stProfileCtrl",["$scope","stAuthSvc","stIdentitySvc","stTickerSvc",function(e,r,t,n){e.email=t.currentUser.userName,e.firstName=t.currentUser.firstName,e.lastName=t.currentUser.lastName,e.update=function(){var t={userName:e.email,firstName:e.firstName,lastName:e.lastName};e.password&&e.password.length>0&&(t.password=e.password),r.updateCurrentUser(t).then(function(){n.notify("Your profile has been updated.")},function(e){n.error(e)})}}]),angular.module("stage").factory("stUserSvc",["$resource",function(e){var r=e("/api/users/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1},purge:{method:"PURGE",isArray:!1}});return r.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},r}]),angular.module("stage").controller("stAdminCtrl",["$scope","$timeout","stAdminSvc","stAdminUserSvc","stAuthSvc","stTickerSvc",function(e,r,t,n,s,a){e.env=t.whatEnv(),e.users=n.populateUsers(),e.userRes=e.users,e.userField="userName",e.userReverse=!1,e.userCurrentPage=0,e.userShowOnPage="10",e.userSyncEnabled="development"==e.env,e.userSyncDir="toloc",e.filterUsers=function(){e.userRes=[];var r=n.searchUsers(e.users,e.userSearch);e.userRes=r,e.userCurrentPage=0},e.sortUsers=function(r,t){e.userReverse=e.userField===r?!e.userReverse:!1,t&&(e.userReverse=e.userField===r?e.userReverse:!0),e.userField=r},e.createUser=function(){var r={userName:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName};s.createUser(r).then(function(){a.notify("Created user account "+r.userName+"."),t.adminRedirect("/admin")},function(e){a.error(e)})},e.purgeUsers=function(){t.adminRedirect("/admin"),t.updateRoot("userPurgeInProgress",!0),r(function(){s.purgeUsers().then(function(){t.adminRedirect("/"),s.logoutUser().then(function(){r(e.purgeDone,5e3)},function(e){a.error(e),t.updateRoot("userPurgeInProgress",!1)})},function(t){a.error(t),r(e.purgeDone,5e3)})},5e3)},e.syncDb=function(n,o){"users"==n&&(t.adminRedirect("/admin"),t.updateRoot("userSyncInProgress",!0),s.syncUsers(o).then(function(){"toloc"==o?(t.adminRedirect("/"),s.logoutUser().then(function(){r(e.syncDone,5e3)},function(e){a.error(e),t.updateRoot("userSyncInProgress",!0)})):r(e.syncDone,5e3)},function(t){a.error(t),r(e.syncDone,5e3)}))},e.pageUsers=function(){return Math.ceil(e.userRes.length/e.userShowOnPage)},e.purgeDone=function(){a.notify("User database has been purged."),t.updateRoot("userPurgeInProgress",!1)},e.syncDone=function(){a.notify("User database has been synced."),t.updateRoot("userSyncInProgress",!0)}}]),angular.module("stage").factory("stAdminSvc",["$location","$parse","$rootScope","$window",function(e,r,t,n){return{adminRedirect:function(r){e.path(r)},updateRoot:function(e,t){var n=r("$rootScope."+e);n=t},whatEnv:function(){return n.env}}}]),angular.module("stage").factory("stAdminUserSvc",["$filter","stUserSvc",function(e,r){return{actionDone:function(e){switch(e){case"purge":var r="purged";$rootScope.userPurgeInProgress=!1;break;case"sync":var r="synced";$rootScope.userSyncInProgress=!1}r&&stTickerSvc.notify("User database has been "+r+".")},populateUsers:function(){return r.query()},searchUsers:function(r,t){return e("userfind")(r,t)}}}]),angular.module("stage").filter("userStartPage",function(){return function(e,r){return r=+r,e.slice(r)}}),angular.module("stage").filter("userfind",function(){return function(e,r){var t=[];return angular.forEach(e,function(e){try{var n=new RegExp(r,"gi")}catch(s){return[]}(e.userName.match(n)||e.firstName.match(n)||e.lastName.match(n)||""==r)&&t.push({_id:e._id,userName:e.userName,firstName:e.firstName,lastName:e.lastName,roles:e.roles})}),t}}),angular.module("stage").controller("stMainCtrl",["$scope",function(e){}]),angular.module("stage").controller("stTickerCtrl",["$scope","stTickerSvc",function(e,r){e.custom=r.custom(),e.reset=r.reset(),e.showAll=function(){$(".ticker-container").toggleClass("expanded")}}]),angular.module("stage").factory("stTickerSvc",function(){function e(e,t,a){e=t?" "+e:e;var o=$("<span></span>").addClass("ticker-msg").html(e);a&&(a=$("<span></span>").addClass("iconic iconic-sm "+a),o.prepend(a)),t&&o.addClass(t),$("#ticker").addClass("on").prepend(o),setTimeout(function(){$("#ticker").removeClass("on")},300),n?(clearTimeout(s),s=setTimeout(function(){r(),n=!1},8e3)):(n=!0,s=setTimeout(function(){r(),n=!1},8e3))}function r(){$("#ticker #ftrmsg").remove();var e=$("<span></span>").html(t).attr("id","ftrmsg");$("#ticker").addClass("on").prepend(e),setTimeout(function(){$("#ticker").removeClass("on")},300)}var t="//tardigrade/node | Tardigrade Digital &copy; 2016",n=!1,s=null;return{custom:function(r,t,n){return r?void e(r,t,"iconic-"+n):!1},notify:function(r){return r?void e(r,"success","iconic-circle-check"):!1},error:function(r){return r?void e(r,"error","iconic-circle-x"):!1},info:function(r){return r?void e(r,null,"iconic-info"):!1},reset:function(){r()}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YWdlLmpzIiwiYWNjb3VudC9zdEF1dGhTdmMuanMiLCJhY2NvdW50L3N0SWRlbnRpdHlTdmMuanMiLCJhY2NvdW50L3N0TG9naW5DdHJsLmpzIiwiYWNjb3VudC9zdExvZ2luV2lkZ2V0LmpzIiwiYWNjb3VudC9zdFByb2ZpbGVDdHJsLmpzIiwiYWNjb3VudC9zdFVzZXJTdmMuanMiLCJhZG1pbi9zdEFkbWluQ3RybC5qcyIsImFkbWluL3N0QWRtaW5TdmMuanMiLCJhZG1pbi9zdEFkbWluVXNlclN2Yy5qcyIsImFkbWluL3N0UGFnZUZpbHRlci5qcyIsImFkbWluL3N0VXNlckZpbHRlci5qcyIsIm1haW4vc3RNYWluQ3RybC5qcyIsInRpY2tlci9zdFRpY2tlckN0cmwuanMiLCJ0aWNrZXIvc3RUaWNrZXJTdmMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJyb3V0ZVJvbGVDaGVja3MiLCJhZG1pbiIsImF1dGgiLCJzdEF1dGhTdmMiLCJhdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlIiwidXNlciIsImF1dGhvcml6ZUF1dGhlbnRpY2F0ZWRVc2VyRm9yUm91dGUiLCJndWVzdCIsInVuYXV0aGVudGljYXRlZFVzZXIiLCJodG1sNU1vZGUiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwicmVzb2x2ZSIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJydW4iLCIkcm9vdFNjb3BlIiwiJGxvY2F0aW9uIiwiJG9uIiwiZXZ0IiwiY3VycmVudCIsInByZXZpb3VzIiwicmVqZWN0aW9uIiwicGF0aCIsImZhY3RvcnkiLCIkaHR0cCIsIiRxIiwic3RJZGVudGl0eVN2YyIsInN0VXNlclN2YyIsImF1dGhlbnRpY2F0ZVVzZXIiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiZGZkIiwiZGVmZXIiLCJwb3N0IiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsInN1Y2Nlc3MiLCJleHRlbmQiLCJjdXJyZW50VXNlciIsInByb21pc2UiLCJjcmVhdGVVc2VyIiwibmV3VXNlckRhdGEiLCJuZXdVc2VyIiwiJHNhdmUiLCJyZWplY3QiLCJyZWFzb24iLCJsb2dvdXRVc2VyIiwibG9nb3V0IiwidW5kZWZpbmVkIiwicHVyZ2VVc2VycyIsIm1ldGhvZCIsInVybCIsImNvbnNvbGUiLCJsb2ciLCJzeW5jVXNlcnMiLCJkaXJlY3Rpb24iLCJoZWFkZXJzIiwiQ29udGVudC1UeXBlIiwiY29sbGVjdGlvbiIsInVwZGF0ZUN1cnJlbnRVc2VyIiwiY2xvbmUiLCJjb3B5IiwiJHVwZGF0ZSIsImlzQXV0aGVudGljYXRlZCIsInJvbGUiLCJpc0F1dGhvcml6ZWQiLCIkd2luZG93Iiwic3RhZ2VVc2VyIiwidGhpcyIsInJvbGVzIiwiaW5kZXhPZiIsIiRzY29wZSIsInN0VGlja2VyU3ZjIiwiaWRlbnRpdHkiLCJzaWduaW4iLCIkaW52YWxpZCIsIiQiLCJsb2dpbldpZGdldCIsImFkZENsYXNzIiwiZXJyb3IiLCJub3RpZnkiLCJzaWdub3V0IiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJyZXBsYWNlIiwiZW1haWwiLCJ1c2VyTmFtZSIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwidXBkYXRlIiwibGVuZ3RoIiwiJHJlc291cmNlIiwiVXNlclJlc291cmNlIiwiX2lkIiwiaXNBcnJheSIsInB1cmdlIiwicHJvdG90eXBlIiwiaXNBZG1pbiIsIiR0aW1lb3V0Iiwic3RBZG1pblN2YyIsInN0QWRtaW5Vc2VyU3ZjIiwiZW52Iiwid2hhdEVudiIsInVzZXJzIiwicG9wdWxhdGVVc2VycyIsInVzZXJSZXMiLCJ1c2VyRmllbGQiLCJ1c2VyUmV2ZXJzZSIsInVzZXJDdXJyZW50UGFnZSIsInVzZXJTaG93T25QYWdlIiwidXNlclN5bmNFbmFibGVkIiwidXNlclN5bmNEaXIiLCJmaWx0ZXJVc2VycyIsInJlcyIsInNlYXJjaFVzZXJzIiwidXNlclNlYXJjaCIsInNvcnRVc2VycyIsImZpZWxkIiwiaW52ZXJ0IiwiYWRtaW5SZWRpcmVjdCIsInVwZGF0ZVJvb3QiLCJwdXJnZURvbmUiLCJzeW5jRGIiLCJzeW5jRGlyIiwic3luY0RvbmUiLCJwYWdlVXNlcnMiLCJNYXRoIiwiY2VpbCIsIiRwYXJzZSIsIm9iaiIsInZhbCIsInJvb3RPYmoiLCIkZmlsdGVyIiwiYWN0aW9uRG9uZSIsImFjdCIsImFjdFZlcmIiLCJ1c2VyUHVyZ2VJblByb2dyZXNzIiwidXNlclN5bmNJblByb2dyZXNzIiwicXVlcnkiLCJmaWx0ZXIiLCJpbnB1dCIsInN0YXJ0Iiwic2xpY2UiLCJxIiwibWF0Y2hlZCIsImZvckVhY2giLCJ1IiwiZXhwIiwiUmVnRXhwIiwiZSIsIm1hdGNoIiwicHVzaCIsImN1c3RvbSIsInJlc2V0Iiwic2hvd0FsbCIsInRvZ2dsZUNsYXNzIiwiYWRkVGlja2VyIiwibXNnIiwibHZsIiwiaWMiLCJtc2dvYmoiLCJodG1sIiwicHJlcGVuZCIsInNldFRpbWVvdXQiLCJyZW1vdmVDbGFzcyIsInRvc2V0IiwiY2xlYXJUaW1lb3V0IiwidG8iLCJyZXNldFRpY2tlciIsInJlbW92ZSIsImZ0ciIsImF0dHIiLCJpbmZvIl0sIm1hcHBpbmdzIjoiQUFBQUEsUUFBQUMsT0FBQSxTQUFBLGFBQUEsVUFBQSxjQUFBLGNBRUFELFFBQUFDLE9BQUEsU0FBQUMsUUFBQSxpQkFBQSxvQkFBQSxTQUFBQyxFQUFBQyxHQUNBLEdBQUFDLElBQ0FDLE9BQUFDLE1BQUEsWUFBQSxTQUFBQyxHQUFBLE1BQUFBLEdBQUFDLDZCQUFBLFlBQ0FDLE1BQUFILE1BQUEsWUFBQSxTQUFBQyxHQUFBLE1BQUFBLEdBQUFHLHdDQUNBQyxPQUFBTCxNQUFBLFlBQUEsU0FBQUMsR0FBQSxNQUFBQSxHQUFBSyx5QkFHQVQsR0FBQVUsV0FBQSxHQUNBWCxFQUNBWSxLQUFBLEtBQ0FDLFlBQUEsc0JBQ0FDLFdBQUEsZUFFQUYsS0FBQSxVQUNBQyxZQUFBLDhCQUNBQyxXQUFBLGNBQ0FDLFFBQUFiLEVBQUFDLFFBRUFTLEtBQUEs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QUFDLEdBQUEsTUFBQUYsT0FBQUQsR0FBQUMsRUFBQUMsRUFBQSxVQUFBQyxJQUFBLEdBQ0EvRSxPQUFBLFNBQUE2RSxHQUFBLE1BQUFBLE9BQUFELEdBQUFDLEVBQUEsVUFBQSx3QkFBQSxHQUNBOUUsTUFBQSxTQUFBOEUsR0FBQSxNQUFBQSxPQUFBRCxHQUFBQyxFQUFBLFFBQUEsb0JBQUEsR0FDQWUsS0FBQSxTQUFBZixHQUFBLE1BQUFBLE9BQUFELEdBQUFDLEVBQUEsS0FBQSxnQkFBQSxHQUNBSixNQUFBLFdBQUFlIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdzdGFnZScsIFsnbmdSZXNvdXJjZScsICduZ1JvdXRlJywgJ3VpLmdyYXZhdGFyJywgJ25nQW5pbWF0ZSddKTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcclxuICB2YXIgcm91dGVSb2xlQ2hlY2tzID0ge1xyXG4gICAgYWRtaW46IHsgYXV0aDogLypAbmdJbmplY3QqLyBmdW5jdGlvbihzdEF1dGhTdmMpIHsgcmV0dXJuIHN0QXV0aFN2Yy5hdXRob3JpemVDdXJyZW50VXNlckZvclJvdXRlKCdhZG1pbicpOyB9IH0sXHJcbiAgICB1c2VyOiB7IGF1dGg6IC8qQG5nSW5qZWN0Ki8gZnVuY3Rpb24oc3RBdXRoU3ZjKSB7IHJldHVybiBzdEF1dGhTdmMuYXV0aG9yaXplQXV0aGVudGljYXRlZFVzZXJGb3JSb3V0ZSgpOyB9IH0sXHJcbiAgICBndWVzdDogeyBhdXRoOiAvKkBuZ0luamVjdCovIGZ1bmN0aW9uKHN0QXV0aFN2YykgeyByZXR1cm4gc3RBdXRoU3ZjLnVuYXV0aGVudGljYXRlZFVzZXIoKTsgfSB9XHJcbiAgfVxyXG5cclxuICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcbiAgJHJvdXRlUHJvdmlkZXJcclxuICAgIC53aGVuKCcvJywgeyBcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvbWFpbi9tYWluJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdE1haW5DdHJsJ1xyXG4gICAgfSlcclxuICAgIC53aGVuKCcvYWRtaW4nLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3ZpZXdzL2FkbWluJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdEFkbWluQ3RybCcsIFxyXG4gICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MuYWRtaW5cclxuICAgIH0pXHJcbiAgICAud2hlbignL2FkbWluL2RkYicsIHtcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vdmlld3MvZGV2LWRhc2hib2FyZCcsIFxyXG4gICAgICBjb250cm9sbGVyOiAnc3RBZG1pbkN0cmwnLCBcclxuICAgICAgcmVzb2x2ZTogcm91dGVSb2xlQ2hlY2tzLmFkbWluXHJcbiAgICB9KVxyXG4gICAgLndoZW4oJy9hZG1pbi91c2Vycy9hZGQnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3ZpZXdzL2FkZC11c2VyJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdEFkbWluQ3RybCcsIFxyXG4gICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MuYWRtaW5cclxuICAgIH0pXHJcbiAgICAud2hlbignL2FkbWluL3VzZXJzL2RlbGV0ZScsIHtcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vdmlld3MvZGVsZXRlLXVzZXInLCBcclxuICAgICAgY29udHJvbGxlcjogJ3N0QWRtaW5DdHJsJywgXHJcbiAgICAgIHJlc29sdmU6IHJvdXRlUm9sZUNoZWNrcy5hZG1pblxyXG4gICAgfSlcclxuICAgIC53aGVuKCcvYWRtaW4vdXNlcnMvcHVyZ2UnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3ZpZXdzL3B1cmdlLXVzZXJzJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdEFkbWluQ3RybCcsIFxyXG4gICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MuYWRtaW5cclxuICAgIH0pXHJcbiAgICAud2hlbignL2FkbWluL3VzZXJzL3N5bmMnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3ZpZXdzL3N5bmMtdXNlcnMnLCBcclxuICAgICAgY29udHJvbGxlcjogJ3N0QWRtaW5DdHJsJywgXHJcbiAgICAgIHJlc29sdmU6IHJvdXRlUm9sZUNoZWNrcy5hZG1pblxyXG4gICAgfSlcclxuICAgIC53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FjY291bnQvdmlld3MvbG9naW4nLCBcclxuICAgICAgY29udHJvbGxlcjogJ3N0TG9naW5DdHJsJyxcclxuICAgICAgcmVzb2x2ZTogcm91dGVSb2xlQ2hlY2tzLmd1ZXN0XHJcbiAgICB9KVxyXG4gICAgLndoZW4oJy9zaWdudXAnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FjY291bnQvdmlld3Mvc2lnbnVwJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdFNpZ251cEN0cmwnLFxyXG4gICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MuZ3Vlc3RcclxuICAgIH0pXHJcbiAgICAud2hlbignL3NldHRpbmdzJywge1xyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9hY2NvdW50L3ZpZXdzL3NldHRpbmdzJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdFByb2ZpbGVDdHJsJyxcclxuICAgICAgcmVzb2x2ZTogcm91dGVSb2xlQ2hlY2tzLnVzZXJcclxuICAgIH0pXHJcbiAgICAub3RoZXJ3aXNlKHtcclxuICAgICAgcmVkaXJlY3RUbzogJy8nXHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7XHJcbiAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZ0LCBjdXJyZW50LCBwcmV2aW91cywgcmVqZWN0aW9uKSB7XHJcbiAgICBpZihyZWplY3Rpb24gPT09ICdub3QgYXV0aG9yaXplZCcpIHtcclxuICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgIH1cclxuICB9KVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5mYWN0b3J5KCdzdEF1dGhTdmMnLCBmdW5jdGlvbigkaHR0cCwgJHEsIHN0SWRlbnRpdHlTdmMsIHN0VXNlclN2Yykge1xyXG4gIHJldHVybiB7XHJcbiAgICAvLyBhdXRoZW50aWNhdGVVc2VyOiBWZXJpZmllcyBsb2dpbiBjcmVkZW50aWFscyBhbmQgc2lnbnMgaW4gdXNlclxyXG4gICAgYXV0aGVudGljYXRlVXNlcjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgIHZhciBkZmQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAkaHR0cC5wb3N0KCcvbG9naW4nLCB7dXNlcm5hbWU6dXNlcm5hbWUsIHBhc3N3b3JkOnBhc3N3b3JkfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuc3VjY2Vzcykge1xyXG4gICAgICAgICAgdmFyIHVzZXIgPSBuZXcgc3RVc2VyU3ZjKCk7XHJcbiAgICAgICAgICBkZWxldGUgcmVzcG9uc2UuZGF0YS51c2VyWydoYXNoZWRfcHdkJ107XHJcbiAgICAgICAgICBkZWxldGUgcmVzcG9uc2UuZGF0YS51c2VyWydzYWx0J107XHJcbiAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh1c2VyLCByZXNwb25zZS5kYXRhLnVzZXIpO1xyXG4gICAgICAgICAgc3RJZGVudGl0eVN2Yy5jdXJyZW50VXNlciA9IHVzZXI7XHJcbiAgICAgICAgICBkZmQucmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBkZmQucmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlO1xyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8gY3JlYXRlVXNlcjogQ3JlYXRlcyBhIG5ldyB1c2VyXHJcbiAgICBjcmVhdGVVc2VyOiBmdW5jdGlvbihuZXdVc2VyRGF0YSkge1xyXG4gICAgICB2YXIgbmV3VXNlciA9IG5ldyBzdFVzZXJTdmMobmV3VXNlckRhdGEpO1xyXG4gICAgICB2YXIgZGZkID0gJHEuZGVmZXIoKTtcclxuICAgICAgXHJcbiAgICAgIG5ld1VzZXIuJHNhdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XHJcbiAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgZGZkLnJlamVjdChyZXNwb25zZS5kYXRhLnJlYXNvbik7XHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gZGZkLnByb21pc2U7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICAvLyBsb2dvdXRVc2VyOiBFbmRzIHRoZSBjdXJyZW50IHVzZXIncyBzZXNzaW9uXHJcbiAgICBsb2dvdXRVc2VyOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIGRmZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICRodHRwLnBvc3QoJy9sb2dvdXQnLCB7bG9nb3V0OiB0cnVlfSkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBzdElkZW50aXR5U3ZjLmN1cnJlbnRVc2VyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGZkLnByb21pc2U7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICAvL3B1cmdlVXNlcnM6IFJlbW92ZXMgYWxsIHVzZXJzIGFuZCByZXN0b3JlcyB1c2VyIGRhdGFiYXNlIHRvIGRlZmF1bHRzXHJcbiAgICBwdXJnZVVzZXJzOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIGRmZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICRodHRwKHtcclxuICAgICAgICBtZXRob2Q6ICdQVVJHRScsXHJcbiAgICAgICAgdXJsOiAnL2FwaS91c2VycydcclxuICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnVXNlciBkYXRhYmFzZSBoYXMgYmVlbiBwdXJnZWQnKTtcclxuICAgICAgICBkZmQucmVzb2x2ZSgpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlO1xyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8gc3luY1VzZXJzOiBTeW5jcyB1c2VyIGRhdGFiYXNlIGNvbGxlY3Rpb25cclxuICAgIHN5bmNVc2VyczogZnVuY3Rpb24oZGlyZWN0aW9uKSB7XHJcbiAgICAgIHZhciBkZmQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAkaHR0cCh7XHJcbiAgICAgICAgbWV0aG9kOiAnQ09QWScsXHJcbiAgICAgICAgdXJsOiAnL2FwaS9kYicsXHJcbiAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgY29sbGVjdGlvbjogJ3VzZXJzJyxcclxuICAgICAgICAgIGRpcmVjdGlvbjogZGlyZWN0aW9uXHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdVc2VyIGRhdGFiYXNlIGhhcyBiZWVuIHN5bmNlZCcpO1xyXG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGZkLnByb21pc2U7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICAvLyB1cGRhdGVDdXJyZW50VXNlcjogVXBkYXRlcyBwcm9maWxlIG9mIGN1cnJlbnQgdXNlclxyXG4gICAgdXBkYXRlQ3VycmVudFVzZXI6IGZ1bmN0aW9uKG5ld1VzZXJEYXRhKSB7XHJcbiAgICAgIHZhciBkZmQgPSAkcS5kZWZlcigpO1xyXG4gICAgICBcclxuICAgICAgdmFyIGNsb25lID0gYW5ndWxhci5jb3B5KHN0SWRlbnRpdHlTdmMuY3VycmVudFVzZXIpO1xyXG4gICAgICBhbmd1bGFyLmV4dGVuZChjbG9uZSwgbmV3VXNlckRhdGEpO1xyXG4gICAgICBjbG9uZS4kdXBkYXRlKCkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBzdElkZW50aXR5U3ZjLmN1cnJlbnRVc2VyID0gY2xvbmU7XHJcbiAgICAgICAgZGZkLnJlc29sdmUoKTtcclxuICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICBkZmQucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVhc29uKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBkZmQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBcclxuICAgIC8vIGF1dGhvcml6ZUF1dGhlbnRpY2F0ZWRVc2VyRm9yUm91dGU6IENoZWNrcyB3aGV0aGVyIHVzZXIgaXMgc2lnbmVkIGluXHJcbiAgICBhdXRob3JpemVBdXRoZW50aWNhdGVkVXNlckZvclJvdXRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgaWYoc3RJZGVudGl0eVN2Yy5pc0F1dGhlbnRpY2F0ZWQoKSkgeyByZXR1cm4gdHJ1ZTsgfVxyXG4gICAgICBlbHNlIHsgcmV0dXJuICRxLnJlamVjdCgnbm90IGF1dGhvcml6ZWQnKTsgfVxyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8gYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZTogQ2hlY2tzIHdoZXRoZXIgY3VyZW50IHVzZXIgaGFzIHJvbGVcclxuICAgIGF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGU6IGZ1bmN0aW9uKHJvbGUpIHtcclxuICAgICAgaWYoc3RJZGVudGl0eVN2Yy5pc0F1dGhvcml6ZWQocm9sZSkpIHsgcmV0dXJuIHRydWU7IH1cclxuICAgICAgZWxzZSB7IHJldHVybiAkcS5yZWplY3QoJ25vdCBhdXRob3JpemVkJyk7IH1cclxuICAgIH0sXHJcbiAgICBcclxuICAgIC8vIHVuYXV0aGVudGljYXRlZFVzZXI6IENoZWNrcyB3aGV0aGVyIHVzZXIgaXMgbm90IHNpZ25lZCBpblxyXG4gICAgdW5hdXRoZW50aWNhdGVkVXNlcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgIGlmKCFzdElkZW50aXR5U3ZjLmlzQXV0aGVudGljYXRlZCgpKSB7IHJldHVybiB0cnVlOyB9XHJcbiAgICAgIGVsc2UgeyByZXR1cm4gJHEucmVqZWN0KCd1c2VyIHNpZ25lZCBpbicpOyB9XHJcbiAgICB9XHJcbiAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5mYWN0b3J5KCdzdElkZW50aXR5U3ZjJywgZnVuY3Rpb24oJHdpbmRvdywgc3RVc2VyU3ZjKSB7XHJcbiAgdmFyIGN1cnJlbnRVc2VyO1xyXG4gIGlmKCR3aW5kb3cuc3RhZ2VVc2VyKSB7IFxyXG4gICAgY3VycmVudFVzZXIgPSBuZXcgc3RVc2VyU3ZjKCk7XHJcbiAgICBkZWxldGUgJHdpbmRvdy5zdGFnZVVzZXJbJ2hhc2hlZF9wd2QnXTtcclxuICAgIGRlbGV0ZSAkd2luZG93LnN0YWdlVXNlclsnc2FsdCddO1xyXG4gICAgYW5ndWxhci5leHRlbmQoY3VycmVudFVzZXIsICR3aW5kb3cuc3RhZ2VVc2VyKTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIGN1cnJlbnRVc2VyOiBjdXJyZW50VXNlcixcclxuICAgIGlzQXV0aGVudGljYXRlZDogZnVuY3Rpb24oKSB7IHJldHVybiAhIXRoaXMuY3VycmVudFVzZXI7IH0sXHJcbiAgICBpc0F1dGhvcml6ZWQ6IGZ1bmN0aW9uKHJvbGUpIHsgcmV0dXJuICEhdGhpcy5jdXJyZW50VXNlciAmJiB0aGlzLmN1cnJlbnRVc2VyLnJvbGVzLmluZGV4T2Yocm9sZSkgPiAtMTsgfVxyXG4gIH1cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3N0YWdlJykuY29udHJvbGxlcignc3RMb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgc3RBdXRoU3ZjLCBzdElkZW50aXR5U3ZjLCBzdFRpY2tlclN2Yykge1xyXG4gICRzY29wZS5pZGVudGl0eSA9IHN0SWRlbnRpdHlTdmM7XHJcbiAgJHNjb3BlLnNpZ25pbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgaWYoIXVzZXJuYW1lIHx8ICFwYXNzd29yZCB8fCB1c2VybmFtZS4kaW52YWxpZCB8fCBwYXNzd29yZC4kaW52YWxpZCkge1xyXG4gICAgICBpZighdXNlcm5hbWUgfHwgdXNlcm5hbWUuJGludmFsaWQpIHsgJChsb2dpbldpZGdldC51c2VybmFtZSkuYWRkQ2xhc3MoJ2ludmFsaWQnKTsgfVxyXG4gICAgICBpZighcGFzc3dvcmQgfHwgcGFzc3dvcmQuJGludmFsaWQpIHsgJChsb2dpbldpZGdldC5wYXNzd29yZCkuYWRkQ2xhc3MoJ2ludmFsaWQnKTsgfVxyXG4gICAgICBzdFRpY2tlclN2Yy5lcnJvcignUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwgYWRkcmVzcyBhbmQgcGFzc3dvcmQuJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTsgIFxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHN0QXV0aFN2Yy5hdXRoZW50aWNhdGVVc2VyKHVzZXJuYW1lLCBwYXNzd29yZCkudGhlbihmdW5jdGlvbihzdWNjZXNzKSB7XHJcbiAgICAgICAgaWYoc3VjY2Vzcykge1xyXG4gICAgICAgICAgdXNlcm5hbWUgPSAnJztcclxuICAgICAgICAgIHBhc3N3b3JkID0gJyc7XHJcbiAgICAgICAgICAkc2NvcGUudXNlcm5hbWUgPSAnJztcclxuICAgICAgICAgICRzY29wZS5wYXNzd29yZCA9ICcnO1xyXG4gICAgICAgICAgdmFyIHBhdGggPSBzdElkZW50aXR5U3ZjLmlzQXV0aG9yaXplZCgnYWRtaW4nKSA/ICcvYWRtaW4nIDogJy8nO1xyXG4gICAgICAgICAgc3RUaWNrZXJTdmMubm90aWZ5KCdZb3UgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkLicpO1xyXG4gICAgICAgICAgaWYoJGxvY2F0aW9uLnBhdGgoJ2xvZ2luJykpIHsgJGxvY2F0aW9uLnBhdGgocGF0aCk7IH1cclxuICAgICAgICAgIGlmKHN0SWRlbnRpdHlTdmMuaXNBdXRob3JpemVkKCdhZG1pbicpKSB7ICRsb2NhdGlvbi5wYXRoKHBhdGgpOyB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgeyBzdFRpY2tlclN2Yy5lcnJvcignSW52YWxpZCBlbWFpbCBhZGRyZXNzIG9yIHBhc3N3b3JkIHdhcyBnaXZlbi4nKSB9XHJcbiAgICAgIH0pOyAgICAgIFxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAkc2NvcGUuc2lnbm91dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgc3RBdXRoU3ZjLmxvZ291dFVzZXIoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAkc2NvcGUudXNlcm5hbWUgPSBcIlwiO1xyXG4gICAgICAkc2NvcGUucGFzc3dvcmQgPSBcIlwiO1xyXG4gICAgICBzdFRpY2tlclN2Yy5ub3RpZnkoJ1lvdSBoYXZlIGJlZW4gc2lnbmVkIG91dC4nKTtcclxuICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgIH0pXHJcbiAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5kaXJlY3RpdmUoJ3N0TG9naW5XaWRnZXQnLCBmdW5jdGlvbigpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9hY2NvdW50L3ZpZXdzL2xvZ2luLXdpZGdldCdcclxuICB9O1xyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5jb250cm9sbGVyKCdzdFByb2ZpbGVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBzdEF1dGhTdmMsIHN0SWRlbnRpdHlTdmMsIHN0VGlja2VyU3ZjKSB7XHJcbiAgJHNjb3BlLmVtYWlsID0gc3RJZGVudGl0eVN2Yy5jdXJyZW50VXNlci51c2VyTmFtZTtcclxuICAkc2NvcGUuZmlyc3ROYW1lID0gc3RJZGVudGl0eVN2Yy5jdXJyZW50VXNlci5maXJzdE5hbWU7XHJcbiAgJHNjb3BlLmxhc3ROYW1lID0gc3RJZGVudGl0eVN2Yy5jdXJyZW50VXNlci5sYXN0TmFtZTtcclxuICBcclxuICAkc2NvcGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgbmV3VXNlckRhdGEgPSB7XHJcbiAgICAgIHVzZXJOYW1lOiAkc2NvcGUuZW1haWwsXHJcbiAgICAgIGZpcnN0TmFtZTogJHNjb3BlLmZpcnN0TmFtZSxcclxuICAgICAgbGFzdE5hbWU6ICRzY29wZS5sYXN0TmFtZVxyXG4gICAgfVxyXG5cclxuICAgIGlmKCRzY29wZS5wYXNzd29yZCAmJiAkc2NvcGUucGFzc3dvcmQubGVuZ3RoID4gMCkgeyBuZXdVc2VyRGF0YS5wYXNzd29yZCA9ICRzY29wZS5wYXNzd29yZDsgfVxyXG5cclxuICAgIHN0QXV0aFN2Yy51cGRhdGVDdXJyZW50VXNlcihuZXdVc2VyRGF0YSkudGhlbihcclxuICAgICAgZnVuY3Rpb24oKSB7IHN0VGlja2VyU3ZjLm5vdGlmeSgnWW91ciBwcm9maWxlIGhhcyBiZWVuIHVwZGF0ZWQuJykgfSwgXHJcbiAgICAgIGZ1bmN0aW9uKHJlYXNvbikgeyBzdFRpY2tlclN2Yy5lcnJvcihyZWFzb24pOyB9XHJcbiAgICApO1xyXG4gIH1cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3N0YWdlJykuZmFjdG9yeSgnc3RVc2VyU3ZjJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XHJcbiAgdmFyIFVzZXJSZXNvdXJjZSA9ICRyZXNvdXJjZSgnL2FwaS91c2Vycy86aWQnLCB7X2lkOiBcIkBpZFwifSwge1xyXG4gICAgdXBkYXRlOiB7bWV0aG9kOiAnUFVUJywgaXNBcnJheTogZmFsc2V9LFxyXG4gICAgcHVyZ2U6IHttZXRob2Q6ICdQVVJHRScsIGlzQXJyYXk6IGZhbHNlfVxyXG4gIH0pO1xyXG4gIFxyXG4gIFVzZXJSZXNvdXJjZS5wcm90b3R5cGUuaXNBZG1pbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucm9sZXMgJiYgdGhpcy5yb2xlcy5pbmRleE9mKCdhZG1pbicpID4gLTE7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBVc2VyUmVzb3VyY2U7XHJcbn0pIiwiYW5ndWxhci5tb2R1bGUoJ3N0YWdlJykuY29udHJvbGxlcignc3RBZG1pbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCBzdEFkbWluU3ZjLCBzdEFkbWluVXNlclN2Yywgc3RBdXRoU3ZjLCBzdFRpY2tlclN2Yykge1xyXG4gICRzY29wZS5lbnYgPSBzdEFkbWluU3ZjLndoYXRFbnYoKTtcclxuICAkc2NvcGUudXNlcnMgPSBzdEFkbWluVXNlclN2Yy5wb3B1bGF0ZVVzZXJzKCk7XHJcbiAgJHNjb3BlLnVzZXJSZXMgPSAkc2NvcGUudXNlcnM7XHJcbiAgJHNjb3BlLnVzZXJGaWVsZCA9ICd1c2VyTmFtZSc7XHJcbiAgJHNjb3BlLnVzZXJSZXZlcnNlID0gZmFsc2U7XHJcbiAgJHNjb3BlLnVzZXJDdXJyZW50UGFnZSA9IDA7XHJcbiAgJHNjb3BlLnVzZXJTaG93T25QYWdlID0gJzEwJztcclxuICAkc2NvcGUudXNlclN5bmNFbmFibGVkID0gJHNjb3BlLmVudiA9PSAnZGV2ZWxvcG1lbnQnID8gdHJ1ZSA6IGZhbHNlO1xyXG4gICRzY29wZS51c2VyU3luY0RpciA9ICd0b2xvYyc7XHJcblxyXG4gICRzY29wZS5maWx0ZXJVc2VycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgJHNjb3BlLnVzZXJSZXMgPSBbXTtcclxuICAgIHZhciByZXMgPSBzdEFkbWluVXNlclN2Yy5zZWFyY2hVc2Vycygkc2NvcGUudXNlcnMsICRzY29wZS51c2VyU2VhcmNoKTtcclxuICAgICRzY29wZS51c2VyUmVzID0gcmVzO1xyXG4gICAgJHNjb3BlLnVzZXJDdXJyZW50UGFnZSA9IDA7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuc29ydFVzZXJzID0gZnVuY3Rpb24oZmllbGQsIGludmVydCkge1xyXG4gICAgJHNjb3BlLnVzZXJSZXZlcnNlID0gKCRzY29wZS51c2VyRmllbGQgPT09IGZpZWxkID8gISRzY29wZS51c2VyUmV2ZXJzZSA6IGZhbHNlKTtcclxuICAgIGlmKGludmVydCkgeyAkc2NvcGUudXNlclJldmVyc2UgPSAoJHNjb3BlLnVzZXJGaWVsZCA9PT0gZmllbGQgPyAkc2NvcGUudXNlclJldmVyc2UgOiB0cnVlKTsgfVxyXG4gICAgJHNjb3BlLnVzZXJGaWVsZCA9IGZpZWxkO1xyXG4gIH1cclxuICBcclxuICAkc2NvcGUuY3JlYXRlVXNlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIG5ld1VzZXJEYXRhID0ge1xyXG4gICAgICB1c2VyTmFtZTogJHNjb3BlLmVtYWlsLFxyXG4gICAgICBwYXNzd29yZDogJHNjb3BlLnBhc3N3b3JkLFxyXG4gICAgICBmaXJzdE5hbWU6ICRzY29wZS5maXJzdE5hbWUsXHJcbiAgICAgIGxhc3ROYW1lOiAkc2NvcGUubGFzdE5hbWVcclxuICAgIH07XHJcbiAgICBcclxuICAgIHN0QXV0aFN2Yy5jcmVhdGVVc2VyKG5ld1VzZXJEYXRhKS50aGVuKFxyXG4gICAgICBmdW5jdGlvbigpIHsgc3RUaWNrZXJTdmMubm90aWZ5KCdDcmVhdGVkIHVzZXIgYWNjb3VudCAnICsgbmV3VXNlckRhdGEudXNlck5hbWUgKyAgJy4nKTsgc3RBZG1pblN2Yy5hZG1pblJlZGlyZWN0KCcvYWRtaW4nKTsgfSwgXHJcbiAgICAgIGZ1bmN0aW9uKHJlYXNvbikgeyBzdFRpY2tlclN2Yy5lcnJvcihyZWFzb24pOyB9XHJcbiAgICApO1xyXG4gIH1cclxuICBcclxuICAkc2NvcGUucHVyZ2VVc2VycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgc3RBZG1pblN2Yy5hZG1pblJlZGlyZWN0KCcvYWRtaW4nKTtcclxuICAgIHN0QWRtaW5TdmMudXBkYXRlUm9vdCgndXNlclB1cmdlSW5Qcm9ncmVzcycsIHRydWUpO1xyXG4gICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgIHN0QXV0aFN2Yy5wdXJnZVVzZXJzKCkudGhlbihcclxuICAgICAgICBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgc3RBZG1pblN2Yy5hZG1pblJlZGlyZWN0KCcvJyk7XHJcbiAgICAgICAgICAgIHN0QXV0aFN2Yy5sb2dvdXRVc2VyKCkudGhlbihcclxuICAgICAgICAgICAgZnVuY3Rpb24oKSB7ICR0aW1lb3V0KCRzY29wZS5wdXJnZURvbmUsIDUwMDApOyB9LFxyXG4gICAgICAgICAgICBmdW5jdGlvbihyZWFzb24pIHsgXHJcbiAgICAgICAgICAgICAgc3RUaWNrZXJTdmMuZXJyb3IocmVhc29uKTtcclxuICAgICAgICAgICAgICBzdEFkbWluU3ZjLnVwZGF0ZVJvb3QoJ3VzZXJQdXJnZUluUHJvZ3Jlc3MnLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfSwgXHJcbiAgICAgICAgZnVuY3Rpb24ocmVhc29uKSB7IHN0VGlja2VyU3ZjLmVycm9yKHJlYXNvbik7ICR0aW1lb3V0KCRzY29wZS5wdXJnZURvbmUsIDUwMDApOyB9XHJcbiAgICAgICk7XHJcbiAgICB9LCA1MDAwKTtcclxuICB9XHJcbiAgXHJcbiAgJHNjb3BlLnN5bmNEYiA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24sIHN5bmNEaXIpIHtcclxuICAgIGlmKGNvbGxlY3Rpb24gPT0gJ3VzZXJzJykge1xyXG4gICAgICBzdEFkbWluU3ZjLmFkbWluUmVkaXJlY3QoJy9hZG1pbicpO1xyXG4gICAgICBzdEFkbWluU3ZjLnVwZGF0ZVJvb3QoJ3VzZXJTeW5jSW5Qcm9ncmVzcycsIHRydWUpO1xyXG4gICAgICBzdEF1dGhTdmMuc3luY1VzZXJzKHN5bmNEaXIpLnRoZW4oXHJcbiAgICAgICAgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBpZihzeW5jRGlyID09ICd0b2xvYycpIHtcclxuICAgICAgICAgICAgc3RBZG1pblN2Yy5hZG1pblJlZGlyZWN0KCcvJyk7XHJcbiAgICAgICAgICAgIHN0QXV0aFN2Yy5sb2dvdXRVc2VyKCkudGhlbihcclxuICAgICAgICAgICAgICBmdW5jdGlvbigpIHsgJHRpbWVvdXQoJHNjb3BlLnN5bmNEb25lLCA1MDAwKTsgfSxcclxuICAgICAgICAgICAgICBmdW5jdGlvbihyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIHN0VGlja2VyU3ZjLmVycm9yKHJlYXNvbik7XHJcbiAgICAgICAgICAgICAgICBzdEFkbWluU3ZjLnVwZGF0ZVJvb3QoJ3VzZXJTeW5jSW5Qcm9ncmVzcycsIHRydWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2UgeyAkdGltZW91dCgkc2NvcGUuc3luY0RvbmUsIDUwMDApOyB9XHJcbiAgICAgICB9LFxyXG4gICAgICAgIGZ1bmN0aW9uKHJlYXNvbikgeyBzdFRpY2tlclN2Yy5lcnJvcihyZWFzb24pOyAkdGltZW91dCgkc2NvcGUuc3luY0RvbmUsIDUwMDApOyB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gICRzY29wZS5wYWdlVXNlcnMgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBNYXRoLmNlaWwoJHNjb3BlLnVzZXJSZXMubGVuZ3RoLyRzY29wZS51c2VyU2hvd09uUGFnZSk7XHJcbiAgfVxyXG4gIFxyXG4gICRzY29wZS5wdXJnZURvbmUgPSBmdW5jdGlvbigpIHtcclxuICAgIHN0VGlja2VyU3ZjLm5vdGlmeSgnVXNlciBkYXRhYmFzZSBoYXMgYmVlbiBwdXJnZWQuJyk7IFxyXG4gICAgc3RBZG1pblN2Yy51cGRhdGVSb290KCd1c2VyUHVyZ2VJblByb2dyZXNzJywgZmFsc2UpO1xyXG4gIH1cclxuICBcclxuICAkc2NvcGUuc3luY0RvbmUgPSBmdW5jdGlvbigpIHtcclxuICAgIHN0VGlja2VyU3ZjLm5vdGlmeSgnVXNlciBkYXRhYmFzZSBoYXMgYmVlbiBzeW5jZWQuJyk7IFxyXG4gICAgc3RBZG1pblN2Yy51cGRhdGVSb290KCd1c2VyU3luY0luUHJvZ3Jlc3MnLCB0cnVlKTtcclxuICB9XHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmZhY3RvcnkoJ3N0QWRtaW5TdmMnLCBmdW5jdGlvbigkbG9jYXRpb24sICRwYXJzZSwgJHJvb3RTY29wZSwgJHdpbmRvdykge1xyXG4gIHJldHVybiB7XHJcbiAgICBhZG1pblJlZGlyZWN0OiBmdW5jdGlvbihwYXRoKSB7XHJcbiAgICAgICRsb2NhdGlvbi5wYXRoKHBhdGgpO1xyXG4gICAgfSxcclxuICAgIHVwZGF0ZVJvb3Q6IGZ1bmN0aW9uKG9iaiwgdmFsKSB7XHJcbiAgICAgIHZhciByb290T2JqID0gJHBhcnNlKCckcm9vdFNjb3BlLicgKyBvYmopO1xyXG4gICAgICByb290T2JqID0gdmFsO1xyXG4gICAgfSxcclxuICAgIHdoYXRFbnY6IGZ1bmN0aW9uKCkge1xyXG4gICAgICByZXR1cm4gJHdpbmRvdy5lbnY7XHJcbiAgICB9XHJcbiAgfTtcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3N0YWdlJykuZmFjdG9yeSgnc3RBZG1pblVzZXJTdmMnLCBmdW5jdGlvbigkZmlsdGVyLCBzdFVzZXJTdmMpIHtcclxuICByZXR1cm4ge1xyXG4gICAgYWN0aW9uRG9uZTogZnVuY3Rpb24oYWN0KSB7XHJcbiAgICAgIHN3aXRjaChhY3QpIHtcclxuICAgICAgICBjYXNlICdwdXJnZSc6XHJcbiAgICAgICAgICB2YXIgYWN0VmVyYiA9ICdwdXJnZWQnXHJcbiAgICAgICAgICAkcm9vdFNjb3BlLnVzZXJQdXJnZUluUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3N5bmMnOlxyXG4gICAgICAgICAgdmFyIGFjdFZlcmIgPSAnc3luY2VkJ1xyXG4gICAgICAgICAgJHJvb3RTY29wZS51c2VyU3luY0luUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGlmKGFjdFZlcmIpIHtzdFRpY2tlclN2Yy5ub3RpZnkoJ1VzZXIgZGF0YWJhc2UgaGFzIGJlZW4gJyArIGFjdFZlcmIgKyAnLicpOyB9XHJcbiAgICB9LFxyXG4gICAgcG9wdWxhdGVVc2VyczogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiBzdFVzZXJTdmMucXVlcnkoKTtcclxuICAgIH0sXHJcbiAgICBzZWFyY2hVc2VyczogZnVuY3Rpb24odXNlcnMsIHF1ZXJ5KSB7XHJcbiAgICAgIHJldHVybiAkZmlsdGVyKCd1c2VyZmluZCcpKHVzZXJzLCBxdWVyeSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3N0YWdlJykuZmlsdGVyKCd1c2VyU3RhcnRQYWdlJywgZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHN0YXJ0KSB7XHJcbiAgICAgICAgc3RhcnQgPSArc3RhcnQ7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0LnNsaWNlKHN0YXJ0KTtcclxuICAgIH1cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3N0YWdlJykuZmlsdGVyKCd1c2VyZmluZCcsIGZ1bmN0aW9uKCkge1xyXG4gIHJldHVybiBmdW5jdGlvbih1c2VycywgcSkge1xyXG4gICAgdmFyIG1hdGNoZWQgPSBbXTtcclxuICAgIGFuZ3VsYXIuZm9yRWFjaCh1c2VycywgZnVuY3Rpb24odSkge1xyXG4gICAgICB0cnkgeyB2YXIgZXhwID0gbmV3IFJlZ0V4cChxLCAnZ2knKTsgfSBjYXRjaChlKSB7IHJldHVybiBbXTsgfVxyXG4gICAgICBpZih1LnVzZXJOYW1lLm1hdGNoKGV4cCkgfHwgdS5maXJzdE5hbWUubWF0Y2goZXhwKSB8fCB1Lmxhc3ROYW1lLm1hdGNoKGV4cCkgfHwgcSA9PSAnJykge1xyXG4gICAgICAgIG1hdGNoZWQucHVzaCh7XHJcbiAgICAgICAgICBfaWQ6IHUuX2lkLCBcclxuICAgICAgICAgIHVzZXJOYW1lOiB1LnVzZXJOYW1lLCBcclxuICAgICAgICAgIGZpcnN0TmFtZTogdS5maXJzdE5hbWUsIFxyXG4gICAgICAgICAgbGFzdE5hbWU6IHUubGFzdE5hbWUsXHJcbiAgICAgICAgICByb2xlczogdS5yb2xlc1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1hdGNoZWQ7XHJcbiAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5jb250cm9sbGVyKCdzdE1haW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5jb250cm9sbGVyKCdzdFRpY2tlckN0cmwnLCBbJyRzY29wZScsICdzdFRpY2tlclN2YycsIGZ1bmN0aW9uKCRzY29wZSwgc3RUaWNrZXJTdmMpIHtcclxuICAkc2NvcGUuY3VzdG9tID0gc3RUaWNrZXJTdmMuY3VzdG9tKCk7XHJcbiAgJHNjb3BlLnJlc2V0ID0gc3RUaWNrZXJTdmMucmVzZXQoKTtcclxuICAkc2NvcGUuc2hvd0FsbCA9IGZ1bmN0aW9uKCkgeyAkKCcudGlja2VyLWNvbnRhaW5lcicpLnRvZ2dsZUNsYXNzKCdleHBhbmRlZCcpOyB9XHJcbn1dKTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5mYWN0b3J5KCdzdFRpY2tlclN2YycsIGZ1bmN0aW9uKCkge1xyXG4gIHZhciBmdHIgPSAnLy90YXJkaWdyYWRlL25vZGUgfCBUYXJkaWdyYWRlIERpZ2l0YWwgJmNvcHk7IDIwMTYnO1xyXG4gIHZhciB0b3NldCA9IGZhbHNlO1xyXG4gIHZhciB0byA9IG51bGw7XHJcbiAgXHJcbiAgZnVuY3Rpb24gYWRkVGlja2VyKG1zZywgbHZsLCBpYykge1xyXG4gICAgbXNnID0gbHZsID8gKCcgJyArIG1zZykgOiBtc2c7XHJcbiAgICB2YXIgbXNnb2JqID0gJCgnPHNwYW4+PC9zcGFuPicpLmFkZENsYXNzKCd0aWNrZXItbXNnJykuaHRtbChtc2cpO1xyXG4gICAgaWYoaWMpIHsgXHJcbiAgICAgIGljID0gJCgnPHNwYW4+PC9zcGFuPicpLmFkZENsYXNzKCdpY29uaWMgaWNvbmljLXNtICcgKyBpYyk7IFxyXG4gICAgICBtc2dvYmoucHJlcGVuZChpYyk7IFxyXG4gICAgfVxyXG4gICAgaWYobHZsKSB7IG1zZ29iai5hZGRDbGFzcyhsdmwpOyB9XHJcbiAgICAkKCcjdGlja2VyJykuYWRkQ2xhc3MoJ29uJykucHJlcGVuZChtc2dvYmopO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHskKCcjdGlja2VyJykucmVtb3ZlQ2xhc3MoJ29uJyk7fSwgMzAwKTtcclxuICAgIGlmKCF0b3NldCkgeyB0b3NldCA9IHRydWU7IHRvID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsgcmVzZXRUaWNrZXIoKTsgdG9zZXQgPSBmYWxzZTsgfSwgODAwMCk7IH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBjbGVhclRpbWVvdXQodG8pO1xyXG4gICAgICB0byA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHJlc2V0VGlja2VyKCk7IHRvc2V0ID0gZmFsc2U7IH0sIDgwMDApO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICBmdW5jdGlvbiByZXNldFRpY2tlcigpIHtcclxuICAgICQoJyN0aWNrZXIgI2Z0cm1zZycpLnJlbW92ZSgpO1xyXG4gICAgdmFyIG1zZ29iaiA9ICQoJzxzcGFuPjwvc3Bhbj4nKS5odG1sKGZ0cikuYXR0cignaWQnLCAnZnRybXNnJyk7XHJcbiAgICAkKCcjdGlja2VyJykuYWRkQ2xhc3MoJ29uJykucHJlcGVuZChtc2dvYmopO1xyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHskKCcjdGlja2VyJykucmVtb3ZlQ2xhc3MoJ29uJyk7fSwgMzAwKTtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGN1c3RvbTogZnVuY3Rpb24obXNnLCBsdmwsIGljKSB7IGlmKCFtc2cpIHsgcmV0dXJuIGZhbHNlOyB9OyBhZGRUaWNrZXIobXNnLCBsdmwsICgnaWNvbmljLScgKyBpYykpOyB9LFxyXG4gICAgbm90aWZ5OiBmdW5jdGlvbihtc2cpIHsgaWYoIW1zZykgeyByZXR1cm4gZmFsc2U7IH07IGFkZFRpY2tlcihtc2csICdzdWNjZXNzJywgJ2ljb25pYy1jaXJjbGUtY2hlY2snKTsgfSxcclxuICAgIGVycm9yOiBmdW5jdGlvbihtc2cpIHsgaWYoIW1zZykgeyByZXR1cm4gZmFsc2U7IH07IGFkZFRpY2tlcihtc2csICdlcnJvcicsICdpY29uaWMtY2lyY2xlLXgnKTsgfSxcclxuICAgIGluZm86IGZ1bmN0aW9uKG1zZykgeyBpZighbXNnKSB7IHJldHVybiBmYWxzZTsgfTsgYWRkVGlja2VyKG1zZywgbnVsbCwgJ2ljb25pYy1pbmZvJyk7IH0sXHJcbiAgICByZXNldDogZnVuY3Rpb24oKSB7IHJlc2V0VGlja2VyKCk7IH1cclxuICB9XHJcbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
