angular.module("stage",["ngResource","ngRoute","ui.gravatar","ngAnimate"]),angular.module("stage").config(["$routeProvider","$locationProvider",function(e,r){var t={admin:{auth:["stAuth",function(e){return e.authorizeCurrentUserForRoute("admin")}]},user:{auth:["stAuth",function(e){return e.authorizeAuthenticatedUserForRoute()}]},guest:{auth:["stAuth",function(e){return e.unauthenticatedUser()}]}};r.html5Mode(!0),e.when("/",{templateUrl:"/partials/main/main",controller:"stMainCtrl"}).when("/admin",{templateUrl:"/partials/admin/views/admin",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/add",{templateUrl:"/partials/admin/views/add-user",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/delete",{templateUrl:"/partials/admin/views/delete-user",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/purge",{templateUrl:"/partials/admin/views/purge-users",controller:"stAdminCtrl",resolve:t.admin}).when("/admin/users/sync",{templateUrl:"/partials/admin/views/sync-users",controller:"stAdminCtrl",resolve:t.admin}).when("/login",{templateUrl:"/partials/account/views/login",controller:"stLoginCtrl",resolve:t.guest}).when("/signup",{templateUrl:"/partials/account/views/signup",controller:"stSignupCtrl",resolve:t.guest}).when("/settings",{templateUrl:"/partials/account/views/settings",controller:"stProfileCtrl",resolve:t.user}).otherwise({redirectTo:"/"})}]),angular.module("stage").run(["$rootScope","$location",function(e,r){e.$on("$routeChangeError",function(e,t,n,s){"not authorized"===s&&r.path("/")})}]),angular.module("stage").factory("stAuth",["$http","$q","stIdentity","stUser",function(e,r,t,n){return{authenticateUser:function(s,a){var o=r.defer();return e.post("/login",{username:s,password:a}).then(function(e){if(e.data.success){var r=new n;delete e.data.user.hashed_pwd,delete e.data.user.salt,angular.extend(r,e.data.user),t.currentUser=r,o.resolve(!0)}else o.resolve(!1)}),o.promise},createUser:function(e){var t=new n(e),s=r.defer();return t.$save().then(function(){s.resolve()},function(e){s.reject(e.data.reason)}),s.promise},logoutUser:function(){var n=r.defer();return e.post("/logout",{logout:!0}).then(function(){t.currentUser=void 0,n.resolve()}),n.promise},purgeUsers:function(){var t=r.defer();return e({method:"PURGE",url:"/api/users"}).then(function(){console.log("User database has been purged"),t.resolve()}),t.promise},syncUsers:function(t){var n=r.defer();return e({method:"COPY",url:"/api/db",headers:{"Content-Type":"application/json"},data:{collection:"users",direction:t}}).then(function(){console.log("User database has been synced"),n.resolve()}),n.promise},updateCurrentUser:function(e){var n=r.defer(),s=angular.copy(t.currentUser);return angular.extend(s,e),s.$update().then(function(){t.currentUser=s,n.resolve()},function(e){n.reject(e.data.reason)}),n.promise},authorizeAuthenticatedUserForRoute:function(){return t.isAuthenticated()?!0:r.reject("not authorized")},authorizeCurrentUserForRoute:function(e){return t.isAuthorized(e)?!0:r.reject("not authorized")},unauthenticatedUser:function(){return t.isAuthenticated()?r.reject("user signed in"):!0}}}]),angular.module("stage").factory("stIdentity",["$window","stUser",function(e,r){var t;return e.stageUser&&(t=new r,delete e.stageUser.hashed_pwd,delete e.stageUser.salt,angular.extend(t,e.stageUser)),{currentUser:t,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(e){return!!this.currentUser&&this.currentUser.roles.indexOf(e)>-1}}}]),angular.module("stage").controller("stLoginCtrl",["$scope","stIdentity","stTickerSvc","stAuth","$location",function(e,r,t,n,s){e.identity=r,e.signin=function(a,o){return!a||!o||a.$invalid||o.$invalid?(a&&!a.$invalid||$(loginWidget.username).addClass("invalid"),o&&!o.$invalid||$(loginWidget.password).addClass("invalid"),t.error("Please enter a valid email address and password."),!1):void n.authenticateUser(a,o).then(function(n){if(n){a="",o="",e.username="",e.password="";var i=r.isAuthorized("admin")?"/admin":"/";t.notify("You have been successfully authenticated."),s.path("login")&&s.path(i),r.isAuthorized("admin")&&s.path(i)}else t.error("Invalid email address or password was given.")})},e.signout=function(){n.logoutUser().then(function(){e.username="",e.password="",t.notify("You have been signed out."),s.path("/")})}}]),angular.module("stage").directive("stLoginWidget",function(){return{restrict:"E",replace:!0,templateUrl:"/partials/account/views/login-widget"}}),angular.module("stage").controller("stProfileCtrl",["$scope","stAuth","stIdentity","stTickerSvc",function(e,r,t,n){e.email=t.currentUser.userName,e.fname=t.currentUser.firstName,e.lname=t.currentUser.lastName,e.update=function(){var t={userName:e.email,firstName:e.fname,lastName:e.lname};e.password&&e.password.length>0&&(t.password=e.password),r.updateCurrentUser(t).then(function(){n.notify("Your profile has been updated.")},function(e){n.error(e)})}}]),angular.module("stage").factory("stUser",["$resource",function(e){var r=e("/api/users/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1},purge:{method:"PURGE",isArray:!1}});return r.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},r}]),angular.module("stage").factory(function(){}),angular.module("stage").controller("stAdminCtrl",["$scope","$filter","$location","$timeout","$rootScope","stAuth","stTickerSvc","stUser",function(e,r,t,n,s,a,o,i){e.users=i.query(),e.userRes=e.users,e.userField="userName",e.userReverse=!1,e.userCurrentPage=0,e.userShowOnPage="10",e.userSyncEnabled="development"==window.env,e.userSyncDir="toloc",e.filterUsers=function(){e.userRes=[];var t=r("userfind")(e.users,e.userSearch);e.userRes=t,e.userCurrentPage=0},e.sortUsers=function(r,t){e.userReverse=e.userField===r?!e.userReverse:!1,t&&(e.userReverse=e.userField===r?e.userReverse:!0),e.userField=r},e.createUser=function(){var r={userName:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName};a.createUser(r).then(function(){o.notify("Created user account "+r.userName+"."),t.path("/admin")},function(e){o.error(e)})},e.purgeUsers=function(){t.path("/admin"),s.userPurgeInProgress=!0,n(function(){a.purgeUsers().then(function(){t.path("/"),a.logoutUser().then(function(){n(e.purgeDone,5e3)},function(e){o.error(e),s.userPurgeInProgress=!1})},function(r){o.error(r),n(e.purgeDone,5e3)})},5e3)},e.syncDb=function(r,i){"users"==r&&(t.path("/admin"),s.userSyncInProgress=!0,a.syncUsers(i).then(function(){"toloc"==i?(t.path("/"),a.logoutUser().then(function(){n(e.syncDone,5e3)},function(e){o.error(e),s.userSyncInProgress=!1})):n(e.syncDone,5e3)},function(r){o.error(r),n(e.syncDone,5e3)}))},e.pageUsers=function(){return Math.ceil(e.userRes.length/e.userShowOnPage)},e.purgeDone=function(){o.notify("User database has been purged."),s.userPurgeInProgress=!1},e.syncDone=function(){o.notify("User database has been synced."),s.userSyncInProgress=!1}}]),angular.module("stage").filter("userStartPage",function(){return function(e,r){return r=+r,e.slice(r)}}),angular.module("stage").filter("userfind",function(){return function(e,r){var t=[];return angular.forEach(e,function(e){try{var n=new RegExp(r,"gi")}catch(s){return[]}(e.userName.match(n)||e.firstName.match(n)||e.lastName.match(n)||""==r)&&t.push({_id:e._id,userName:e.userName,firstName:e.firstName,lastName:e.lastName,roles:e.roles})}),t}}),angular.module("stage").controller("stMainCtrl",["$scope",function(e){}]),angular.module("stage").controller("stTickerCtrl",["$scope","stTickerSvc",function(e,r){e.custom=r.custom(),e.reset=r.reset(),e.showAll=function(){$(".ticker-container").toggleClass("expanded")}}]),angular.module("stage").factory("stTickerSvc",function(){function e(e,t,a){e=t?" "+e:e;var o=$("<span></span>").addClass("ticker-msg").html(e);a&&(a=$("<span></span>").addClass("iconic iconic-sm "+a),o.prepend(a)),t&&o.addClass(t),$("#ticker").addClass("on").prepend(o),setTimeout(function(){$("#ticker").removeClass("on")},300),n?(clearTimeout(s),s=setTimeout(function(){r(),n=!1},8e3)):(n=!0,s=setTimeout(function(){r(),n=!1},8e3))}function r(){$("#ticker #ftrmsg").remove();var e=$("<span></span>").html(t).attr("id","ftrmsg");$("#ticker").addClass("on").prepend(e),setTimeout(function(){$("#ticker").removeClass("on")},300)}var t="//tardigrade/node | Tardigrade Digital &copy; 2016",n=!1,s=null;return{custom:function(r,t,n){return r?void e(r,t,"iconic-"+n):!1},notify:function(r){return r?void e(r,"success","iconic-circle-check"):!1},error:function(r){return r?void e(r,"error","iconic-circle-x"):!1},info:function(r){return r?void e(r,null,"iconic-info"):!1},reset:function(){r()}}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YWdlLmpzIiwiYWNjb3VudC9zdEF1dGguanMiLCJhY2NvdW50L3N0SWRlbnRpdHkuanMiLCJhY2NvdW50L3N0TG9naW5DdHJsLmpzIiwiYWNjb3VudC9zdExvZ2luV2lkZ2V0LmpzIiwiYWNjb3VudC9zdFByb2ZpbGVDdHJsLmpzIiwiYWNjb3VudC9zdFVzZXIuanMiLCJhZG1pbi9zdEFkbWluLmpzIiwiYWRtaW4vc3RBZG1pbkN0cmwuanMiLCJhZG1pbi9zdFBhZ2VGaWx0ZXIuanMiLCJhZG1pbi9zdFVzZXJGaWx0ZXIuanMiLCJtYWluL3N0TWFpbkN0cmwuanMiLCJ0aWNrZXIvc3RUaWNrZXJDdHJsLmpzIiwidGlja2VyL3N0VGlja2VyU3ZjLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwicm91dGVSb2xlQ2hlY2tzIiwiYWRtaW4iLCJhdXRoIiwic3RBdXRoIiwiYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZSIsInVzZXIiLCJhdXRob3JpemVBdXRoZW50aWNhdGVkVXNlckZvclJvdXRlIiwiZ3Vlc3QiLCJ1bmF1dGhlbnRpY2F0ZWRVc2VyIiwiaHRtbDVNb2RlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInJlc29sdmUiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiJHJvb3RTY29wZSIsIiRsb2NhdGlvbiIsIiRvbiIsImV2dCIsImN1cnJlbnQiLCJwcmV2aW91cyIsInJlamVjdGlvbiIsInBhdGgiLCJmYWN0b3J5IiwiJGh0dHAiLCIkcSIsInN0SWRlbnRpdHkiLCJzdFVzZXIiLCJhdXRoZW50aWNhdGVVc2VyIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImRmZCIsImRlZmVyIiwicG9zdCIsInRoZW4iLCJyZXNwb25zZSIsImRhdGEiLCJzdWNjZXNzIiwiZXh0ZW5kIiwiY3VycmVudFVzZXIiLCJwcm9taXNlIiwiY3JlYXRlVXNlciIsIm5ld1VzZXJEYXRhIiwibmV3VXNlciIsIiRzYXZlIiwicmVqZWN0IiwicmVhc29uIiwibG9nb3V0VXNlciIsImxvZ291dCIsInVuZGVmaW5lZCIsInB1cmdlVXNlcnMiLCJtZXRob2QiLCJ1cmwiLCJjb25zb2xlIiwibG9nIiwic3luY1VzZXJzIiwiZGlyZWN0aW9uIiwiaGVhZGVycyIsIkNvbnRlbnQtVHlwZSIsImNvbGxlY3Rpb24iLCJ1cGRhdGVDdXJyZW50VXNlciIsImNsb25lIiwiY29weSIsIiR1cGRhdGUiLCJpc0F1dGhlbnRpY2F0ZWQiLCJyb2xlIiwiaXNBdXRob3JpemVkIiwiJHdpbmRvdyIsInN0YWdlVXNlciIsInRoaXMiLCJyb2xlcyIsImluZGV4T2YiLCIkc2NvcGUiLCJzdFRpY2tlclN2YyIsImlkZW50aXR5Iiwic2lnbmluIiwiJGludmFsaWQiLCIkIiwibG9naW5XaWRnZXQiLCJhZGRDbGFzcyIsImVycm9yIiwibm90aWZ5Iiwic2lnbm91dCIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwicmVwbGFjZSIsImVtYWlsIiwidXNlck5hbWUiLCJmbmFtZSIsImZpcnN0TmFtZSIsImxuYW1lIiwibGFzdE5hbWUiLCJ1cGRhdGUiLCJsZW5ndGgiLCIkcmVzb3VyY2UiLCJVc2VyUmVzb3VyY2UiLCJfaWQiLCJpc0FycmF5IiwicHVyZ2UiLCJwcm90b3R5cGUiLCJpc0FkbWluIiwiJGZpbHRlciIsIiR0aW1lb3V0IiwidXNlcnMiLCJxdWVyeSIsInVzZXJSZXMiLCJ1c2VyRmllbGQiLCJ1c2VyUmV2ZXJzZSIsInVzZXJDdXJyZW50UGFnZSIsInVzZXJTaG93T25QYWdlIiwidXNlclN5bmNFbmFibGVkIiwid2luZG93IiwiZW52IiwidXNlclN5bmNEaXIiLCJmaWx0ZXJVc2VycyIsInJlcyIsInVzZXJTZWFyY2giLCJzb3J0VXNlcnMiLCJmaWVsZCIsImludmVydCIsInVzZXJQdXJnZUluUHJvZ3Jlc3MiLCJwdXJnZURvbmUiLCJzeW5jRGIiLCJzeW5jRGlyIiwidXNlclN5bmNJblByb2dyZXNzIiwic3luY0RvbmUiLCJwYWdlVXNlcnMiLCJNYXRoIiwiY2VpbCIsImZpbHRlciIsImlucHV0Iiwic3RhcnQiLCJzbGljZSIsInEiLCJtYXRjaGVkIiwiZm9yRWFjaCIsInUiLCJleHAiLCJSZWdFeHAiLCJlIiwibWF0Y2giLCJwdXNoIiwiY3VzdG9tIiwicmVzZXQiLCJzaG93QWxsIiwidG9nZ2xlQ2xhc3MiLCJhZGRUaWNrZXIiLCJtc2ciLCJsdmwiLCJpYyIsIm1zZ29iaiIsImh0bWwiLCJwcmVwZW5kIiwic2V0VGltZW91dCIsInJlbW92ZUNsYXNzIiwidG9zZXQiLCJjbGVhclRpbWVvdXQiLCJ0byIsInJlc2V0VGlja2VyIiwicmVtb3ZlIiwiZnRyIiwiYXR0ciIsImluZm8iXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFBQyxPQUFBLFNBQUEsYUFBQSxVQUFBLGNBQUEsY0FFQUQsUUFBQUMsT0FBQSxTQUFBQyxRQUFBLGlCQUFBLG9CQUFBLFNBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsSUFDQUMsT0FBQUMsTUFBQSxTQUFBLFNBQUFDLEdBQUEsTUFBQUEsR0FBQUMsNkJBQUEsWUFDQUMsTUFBQUgsTUFBQSxTQUFBLFNBQUFDLEdBQUEsTUFBQUEsR0FBQUcsd0NBQ0FDLE9BQUFMLE1BQUEsU0FBQSxTQUFBQyxHQUFBLE1BQUFBLEdBQUFLLHlCQUdBVCxHQUFBVSxXQUFBLEdBQ0FYLEVBQ0FZLEtBQUEsS0FDQUMsWUFBQSxzQkFDQUMsV0FBQSxlQUVBRixLQUFBLFVBQ0FDLFlBQUEsOEJBQ0FDLFdBQUEsY0FDQUMsUUFBQWIsRUFBQUMsUUFFQVMsS0FBQSxvQkFDQUMsWUFBQSxpQ0FDQUMsV0FBQSxjQUNBQyxRQUFBYixFQUFBQyxRQUVBUyxLQUFBLHVCQUNBQyxZQUFBLG9DQUNBQyxXQUFBLGNBQ0FDLFFBQUFiLEVBQUFDLFFBRUFTLEtBQUEsc0JBQ0FDLFlBQUEsb0NBQ0FDLFdBQUEsY0FDQUMsUUFBQWIsRUFBQUMsUUFFQVMsS0FBQSxxQkFDQUMsWUFBQSxtQ0FDQUMsV0FB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QXlFLFFBQUFGLEdBQ0FHLFdBQUEsV0FBQTVFLEVBQUEsV0FBQTZFLFlBQUEsT0FBQSxLQXpCQSxHQUFBTSxHQUFBLHFEQUNBTCxHQUFBLEVBQ0FFLEVBQUEsSUEwQkEsUUFDQWYsT0FBQSxTQUFBSyxFQUFBQyxFQUFBQyxHQUFBLE1BQUFGLE9BQUFELEdBQUFDLEVBQUFDLEVBQUEsVUFBQUMsSUFBQSxHQUNBcEUsT0FBQSxTQUFBa0UsR0FBQSxNQUFBQSxPQUFBRCxHQUFBQyxFQUFBLFVBQUEsd0JBQUEsR0FDQW5FLE1BQUEsU0FBQW1FLEdBQUEsTUFBQUEsT0FBQUQsR0FBQUMsRUFBQSxRQUFBLG9CQUFBLEdBQ0FlLEtBQUEsU0FBQWYsR0FBQSxNQUFBQSxPQUFBRCxHQUFBQyxFQUFBLEtBQUEsZ0JBQUEsR0FDQUosTUFBQSxXQUFBZSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnLCBbJ25nUmVzb3VyY2UnLCAnbmdSb3V0ZScsICd1aS5ncmF2YXRhcicsICduZ0FuaW1hdGUnXSk7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XHJcbiAgdmFyIHJvdXRlUm9sZUNoZWNrcyA9IHtcclxuICAgIGFkbWluOiB7IGF1dGg6IC8qQG5nSW5qZWN0Ki8gZnVuY3Rpb24oc3RBdXRoKSB7IHJldHVybiBzdEF1dGguYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZSgnYWRtaW4nKTsgfSB9LFxyXG4gICAgdXNlcjogeyBhdXRoOiAvKkBuZ0luamVjdCovIGZ1bmN0aW9uKHN0QXV0aCkgeyByZXR1cm4gc3RBdXRoLmF1dGhvcml6ZUF1dGhlbnRpY2F0ZWRVc2VyRm9yUm91dGUoKTsgfSB9LFxyXG4gICAgZ3Vlc3Q6IHsgYXV0aDogLypAbmdJbmplY3QqLyBmdW5jdGlvbihzdEF1dGgpIHsgcmV0dXJuIHN0QXV0aC51bmF1dGhlbnRpY2F0ZWRVc2VyKCk7IH0gfVxyXG4gIH1cclxuXHJcbiAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG4gICRyb3V0ZVByb3ZpZGVyXHJcbiAgICAud2hlbignLycsIHsgXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL21haW4vbWFpbicsIFxyXG4gICAgICBjb250cm9sbGVyOiAnc3RNYWluQ3RybCdcclxuICAgIH0pXHJcbiAgICAud2hlbignL2FkbWluJywge1xyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9hZG1pbi92aWV3cy9hZG1pbicsIFxyXG4gICAgICBjb250cm9sbGVyOiAnc3RBZG1pbkN0cmwnLCBcclxuICAgICAgcmVzb2x2ZTogcm91dGVSb2xlQ2hlY2tzLmFkbWluXHJcbiAgICB9KVxyXG4gICAgLndoZW4oJy9hZG1pbi91c2Vycy9hZGQnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3ZpZXdzL2FkZC11c2VyJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdEFkbWluQ3RybCcsIFxyXG4gICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MuYWRtaW5cclxuICAgIH0pXHJcbiAgICAud2hlbignL2FkbWluL3VzZXJzL2RlbGV0ZScsIHtcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vdmlld3MvZGVsZXRlLXVzZXInLCBcclxuICAgICAgY29udHJvbGxlcjogJ3N0QWRtaW5DdHJsJywgXHJcbiAgICAgIHJlc29sdmU6IHJvdXRlUm9sZUNoZWNrcy5hZG1pblxyXG4gICAgfSlcclxuICAgIC53aGVuKCcvYWRtaW4vdXNlcnMvcHVyZ2UnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3ZpZXdzL3B1cmdlLXVzZXJzJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdEFkbWluQ3RybCcsIFxyXG4gICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MuYWRtaW5cclxuICAgIH0pXHJcbiAgICAud2hlbignL2FkbWluL3VzZXJzL3N5bmMnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3ZpZXdzL3N5bmMtdXNlcnMnLCBcclxuICAgICAgY29udHJvbGxlcjogJ3N0QWRtaW5DdHJsJywgXHJcbiAgICAgIHJlc29sdmU6IHJvdXRlUm9sZUNoZWNrcy5hZG1pblxyXG4gICAgfSlcclxuICAgIC53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FjY291bnQvdmlld3MvbG9naW4nLCBcclxuICAgICAgY29udHJvbGxlcjogJ3N0TG9naW5DdHJsJyxcclxuICAgICAgcmVzb2x2ZTogcm91dGVSb2xlQ2hlY2tzLmd1ZXN0XHJcbiAgICB9KVxyXG4gICAgLndoZW4oJy9zaWdudXAnLCB7XHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FjY291bnQvdmlld3Mvc2lnbnVwJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdFNpZ251cEN0cmwnLFxyXG4gICAgICByZXNvbHZlOiByb3V0ZVJvbGVDaGVja3MuZ3Vlc3RcclxuICAgIH0pXHJcbiAgICAud2hlbignL3NldHRpbmdzJywge1xyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9hY2NvdW50L3ZpZXdzL3NldHRpbmdzJywgXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzdFByb2ZpbGVDdHJsJyxcclxuICAgICAgcmVzb2x2ZTogcm91dGVSb2xlQ2hlY2tzLnVzZXJcclxuICAgIH0pXHJcbiAgICAub3RoZXJ3aXNlKHtcclxuICAgICAgcmVkaXJlY3RUbzogJy8nXHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7XHJcbiAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZ0LCBjdXJyZW50LCBwcmV2aW91cywgcmVqZWN0aW9uKSB7XHJcbiAgICBpZihyZWplY3Rpb24gPT09ICdub3QgYXV0aG9yaXplZCcpIHtcclxuICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgIH1cclxuICB9KVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5mYWN0b3J5KCdzdEF1dGgnLCBmdW5jdGlvbigkaHR0cCwgJHEsIHN0SWRlbnRpdHksIHN0VXNlcikge1xyXG4gIHJldHVybiB7XHJcbiAgICAvLyBhdXRoZW50aWNhdGVVc2VyOiBWZXJpZmllcyBsb2dpbiBjcmVkZW50aWFscyBhbmQgc2lnbnMgaW4gdXNlclxyXG4gICAgYXV0aGVudGljYXRlVXNlcjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XHJcbiAgICAgIHZhciBkZmQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAkaHR0cC5wb3N0KCcvbG9naW4nLCB7dXNlcm5hbWU6dXNlcm5hbWUsIHBhc3N3b3JkOnBhc3N3b3JkfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuc3VjY2Vzcykge1xyXG4gICAgICAgICAgdmFyIHVzZXIgPSBuZXcgc3RVc2VyKCk7XHJcbiAgICAgICAgICBkZWxldGUgcmVzcG9uc2UuZGF0YS51c2VyWydoYXNoZWRfcHdkJ107XHJcbiAgICAgICAgICBkZWxldGUgcmVzcG9uc2UuZGF0YS51c2VyWydzYWx0J107XHJcbiAgICAgICAgICBhbmd1bGFyLmV4dGVuZCh1c2VyLCByZXNwb25zZS5kYXRhLnVzZXIpO1xyXG4gICAgICAgICAgc3RJZGVudGl0eS5jdXJyZW50VXNlciA9IHVzZXI7XHJcbiAgICAgICAgICBkZmQucmVzb2x2ZSh0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBkZmQucmVzb2x2ZShmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlO1xyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8gY3JlYXRlVXNlcjogQ3JlYXRlcyBhIG5ldyB1c2VyXHJcbiAgICBjcmVhdGVVc2VyOiBmdW5jdGlvbihuZXdVc2VyRGF0YSkge1xyXG4gICAgICB2YXIgbmV3VXNlciA9IG5ldyBzdFVzZXIobmV3VXNlckRhdGEpO1xyXG4gICAgICB2YXIgZGZkID0gJHEuZGVmZXIoKTtcclxuICAgICAgXHJcbiAgICAgIG5ld1VzZXIuJHNhdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XHJcbiAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgZGZkLnJlamVjdChyZXNwb25zZS5kYXRhLnJlYXNvbik7XHJcbiAgICAgIH0pXHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gZGZkLnByb21pc2U7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICAvLyBsb2dvdXRVc2VyOiBFbmRzIHRoZSBjdXJyZW50IHVzZXIncyBzZXNzaW9uXHJcbiAgICBsb2dvdXRVc2VyOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIGRmZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICRodHRwLnBvc3QoJy9sb2dvdXQnLCB7bG9nb3V0OiB0cnVlfSkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBzdElkZW50aXR5LmN1cnJlbnRVc2VyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGZkLnByb21pc2U7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICAvL3B1cmdlVXNlcnM6IFJlbW92ZXMgYWxsIHVzZXJzIGFuZCByZXN0b3JlcyB1c2VyIGRhdGFiYXNlIHRvIGRlZmF1bHRzXHJcbiAgICBwdXJnZVVzZXJzOiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIGRmZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICRodHRwKHtcclxuICAgICAgICBtZXRob2Q6ICdQVVJHRScsXHJcbiAgICAgICAgdXJsOiAnL2FwaS91c2VycydcclxuICAgICAgfSkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnVXNlciBkYXRhYmFzZSBoYXMgYmVlbiBwdXJnZWQnKTtcclxuICAgICAgICBkZmQucmVzb2x2ZSgpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGRmZC5wcm9taXNlO1xyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8gc3luY1VzZXJzOiBTeW5jcyB1c2VyIGRhdGFiYXNlIGNvbGxlY3Rpb25cclxuICAgIHN5bmNVc2VyczogZnVuY3Rpb24oZGlyZWN0aW9uKSB7XHJcbiAgICAgIHZhciBkZmQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAkaHR0cCh7XHJcbiAgICAgICAgbWV0aG9kOiAnQ09QWScsXHJcbiAgICAgICAgdXJsOiAnL2FwaS9kYicsXHJcbiAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgY29sbGVjdGlvbjogJ3VzZXJzJyxcclxuICAgICAgICAgIGRpcmVjdGlvbjogZGlyZWN0aW9uXHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdVc2VyIGRhdGFiYXNlIGhhcyBiZWVuIHN5bmNlZCcpO1xyXG4gICAgICAgIGRmZC5yZXNvbHZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGZkLnByb21pc2U7XHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICAvLyB1cGRhdGVDdXJyZW50VXNlcjogVXBkYXRlcyBwcm9maWxlIG9mIGN1cnJlbnQgdXNlclxyXG4gICAgdXBkYXRlQ3VycmVudFVzZXI6IGZ1bmN0aW9uKG5ld1VzZXJEYXRhKSB7XHJcbiAgICAgIHZhciBkZmQgPSAkcS5kZWZlcigpO1xyXG4gICAgICBcclxuICAgICAgdmFyIGNsb25lID0gYW5ndWxhci5jb3B5KHN0SWRlbnRpdHkuY3VycmVudFVzZXIpO1xyXG4gICAgICBhbmd1bGFyLmV4dGVuZChjbG9uZSwgbmV3VXNlckRhdGEpO1xyXG4gICAgICBjbG9uZS4kdXBkYXRlKCkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICBzdElkZW50aXR5LmN1cnJlbnRVc2VyID0gY2xvbmU7XHJcbiAgICAgICAgZGZkLnJlc29sdmUoKTtcclxuICAgICAgfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICBkZmQucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVhc29uKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBkZmQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBcclxuICAgIC8vIGF1dGhvcml6ZUF1dGhlbnRpY2F0ZWRVc2VyRm9yUm91dGU6IENoZWNrcyB3aGV0aGVyIHVzZXIgaXMgc2lnbmVkIGluXHJcbiAgICBhdXRob3JpemVBdXRoZW50aWNhdGVkVXNlckZvclJvdXRlOiBmdW5jdGlvbigpIHtcclxuICAgICAgaWYoc3RJZGVudGl0eS5pc0F1dGhlbnRpY2F0ZWQoKSkgeyByZXR1cm4gdHJ1ZTsgfVxyXG4gICAgICBlbHNlIHsgcmV0dXJuICRxLnJlamVjdCgnbm90IGF1dGhvcml6ZWQnKTsgfVxyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLy8gYXV0aG9yaXplQ3VycmVudFVzZXJGb3JSb3V0ZTogQ2hlY2tzIHdoZXRoZXIgY3VyZW50IHVzZXIgaGFzIHJvbGVcclxuICAgIGF1dGhvcml6ZUN1cnJlbnRVc2VyRm9yUm91dGU6IGZ1bmN0aW9uKHJvbGUpIHtcclxuICAgICAgaWYoc3RJZGVudGl0eS5pc0F1dGhvcml6ZWQocm9sZSkpIHsgcmV0dXJuIHRydWU7IH1cclxuICAgICAgZWxzZSB7IHJldHVybiAkcS5yZWplY3QoJ25vdCBhdXRob3JpemVkJyk7IH1cclxuICAgIH0sXHJcbiAgICBcclxuICAgIC8vIHVuYXV0aGVudGljYXRlZFVzZXI6IENoZWNrcyB3aGV0aGVyIHVzZXIgaXMgbm90IHNpZ25lZCBpblxyXG4gICAgdW5hdXRoZW50aWNhdGVkVXNlcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgIGlmKCFzdElkZW50aXR5LmlzQXV0aGVudGljYXRlZCgpKSB7IHJldHVybiB0cnVlOyB9XHJcbiAgICAgIGVsc2UgeyByZXR1cm4gJHEucmVqZWN0KCd1c2VyIHNpZ25lZCBpbicpOyB9XHJcbiAgICB9XHJcbiAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5mYWN0b3J5KCdzdElkZW50aXR5JywgZnVuY3Rpb24oJHdpbmRvdywgc3RVc2VyKSB7XHJcbiAgdmFyIGN1cnJlbnRVc2VyO1xyXG4gIGlmKCR3aW5kb3cuc3RhZ2VVc2VyKSB7IFxyXG4gICAgY3VycmVudFVzZXIgPSBuZXcgc3RVc2VyKCk7XHJcbiAgICBkZWxldGUgJHdpbmRvdy5zdGFnZVVzZXJbJ2hhc2hlZF9wd2QnXTtcclxuICAgIGRlbGV0ZSAkd2luZG93LnN0YWdlVXNlclsnc2FsdCddO1xyXG4gICAgYW5ndWxhci5leHRlbmQoY3VycmVudFVzZXIsICR3aW5kb3cuc3RhZ2VVc2VyKTtcclxuICB9XHJcbiAgcmV0dXJuIHtcclxuICAgIGN1cnJlbnRVc2VyOiBjdXJyZW50VXNlcixcclxuICAgIGlzQXV0aGVudGljYXRlZDogZnVuY3Rpb24oKSB7IHJldHVybiAhIXRoaXMuY3VycmVudFVzZXI7IH0sXHJcbiAgICBpc0F1dGhvcml6ZWQ6IGZ1bmN0aW9uKHJvbGUpIHsgcmV0dXJuICEhdGhpcy5jdXJyZW50VXNlciAmJiB0aGlzLmN1cnJlbnRVc2VyLnJvbGVzLmluZGV4T2Yocm9sZSkgPiAtMTsgfVxyXG4gIH1cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3N0YWdlJykuY29udHJvbGxlcignc3RMb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsIHN0SWRlbnRpdHksIHN0VGlja2VyU3ZjLCBzdEF1dGgsICRsb2NhdGlvbikge1xyXG4gICRzY29wZS5pZGVudGl0eSA9IHN0SWRlbnRpdHk7XHJcbiAgJHNjb3BlLnNpZ25pbiA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xyXG4gICAgaWYoIXVzZXJuYW1lIHx8ICFwYXNzd29yZCB8fCB1c2VybmFtZS4kaW52YWxpZCB8fCBwYXNzd29yZC4kaW52YWxpZCkge1xyXG4gICAgICBpZighdXNlcm5hbWUgfHwgdXNlcm5hbWUuJGludmFsaWQpIHsgJChsb2dpbldpZGdldC51c2VybmFtZSkuYWRkQ2xhc3MoJ2ludmFsaWQnKTsgfVxyXG4gICAgICBpZighcGFzc3dvcmQgfHwgcGFzc3dvcmQuJGludmFsaWQpIHsgJChsb2dpbldpZGdldC5wYXNzd29yZCkuYWRkQ2xhc3MoJ2ludmFsaWQnKTsgfVxyXG4gICAgICBzdFRpY2tlclN2Yy5lcnJvcignUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwgYWRkcmVzcyBhbmQgcGFzc3dvcmQuJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTsgIFxyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHN0QXV0aC5hdXRoZW50aWNhdGVVc2VyKHVzZXJuYW1lLCBwYXNzd29yZCkudGhlbihmdW5jdGlvbihzdWNjZXNzKSB7XHJcbiAgICAgICAgaWYoc3VjY2Vzcykge1xyXG4gICAgICAgICAgdXNlcm5hbWUgPSAnJztcclxuICAgICAgICAgIHBhc3N3b3JkID0gJyc7XHJcbiAgICAgICAgICAkc2NvcGUudXNlcm5hbWUgPSAnJztcclxuICAgICAgICAgICRzY29wZS5wYXNzd29yZCA9ICcnO1xyXG4gICAgICAgICAgdmFyIHBhdGggPSBzdElkZW50aXR5LmlzQXV0aG9yaXplZCgnYWRtaW4nKSA/ICcvYWRtaW4nIDogJy8nO1xyXG4gICAgICAgICAgc3RUaWNrZXJTdmMubm90aWZ5KCdZb3UgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkLicpO1xyXG4gICAgICAgICAgaWYoJGxvY2F0aW9uLnBhdGgoJ2xvZ2luJykpIHsgJGxvY2F0aW9uLnBhdGgocGF0aCk7IH1cclxuICAgICAgICAgIGlmKHN0SWRlbnRpdHkuaXNBdXRob3JpemVkKCdhZG1pbicpKSB7ICRsb2NhdGlvbi5wYXRoKHBhdGgpOyB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgeyBzdFRpY2tlclN2Yy5lcnJvcignSW52YWxpZCBlbWFpbCBhZGRyZXNzIG9yIHBhc3N3b3JkIHdhcyBnaXZlbi4nKSB9XHJcbiAgICAgIH0pOyAgICAgIFxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAkc2NvcGUuc2lnbm91dCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgc3RBdXRoLmxvZ291dFVzZXIoKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAkc2NvcGUudXNlcm5hbWUgPSBcIlwiO1xyXG4gICAgICAkc2NvcGUucGFzc3dvcmQgPSBcIlwiO1xyXG4gICAgICBzdFRpY2tlclN2Yy5ub3RpZnkoJ1lvdSBoYXZlIGJlZW4gc2lnbmVkIG91dC4nKTtcclxuICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgIH0pXHJcbiAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5kaXJlY3RpdmUoJ3N0TG9naW5XaWRnZXQnLCBmdW5jdGlvbigpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9hY2NvdW50L3ZpZXdzL2xvZ2luLXdpZGdldCdcclxuICB9O1xyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5jb250cm9sbGVyKCdzdFByb2ZpbGVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCBzdEF1dGgsIHN0SWRlbnRpdHksIHN0VGlja2VyU3ZjKSB7XHJcbiAgJHNjb3BlLmVtYWlsID0gc3RJZGVudGl0eS5jdXJyZW50VXNlci51c2VyTmFtZTtcclxuICAkc2NvcGUuZm5hbWUgPSBzdElkZW50aXR5LmN1cnJlbnRVc2VyLmZpcnN0TmFtZTtcclxuICAkc2NvcGUubG5hbWUgPSBzdElkZW50aXR5LmN1cnJlbnRVc2VyLmxhc3ROYW1lO1xyXG4gIFxyXG4gICRzY29wZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBuZXdVc2VyRGF0YSA9IHtcclxuICAgICAgdXNlck5hbWU6ICRzY29wZS5lbWFpbCxcclxuICAgICAgZmlyc3ROYW1lOiAkc2NvcGUuZm5hbWUsXHJcbiAgICAgIGxhc3ROYW1lOiAkc2NvcGUubG5hbWVcclxuICAgIH1cclxuXHJcbiAgICBpZigkc2NvcGUucGFzc3dvcmQgJiYgJHNjb3BlLnBhc3N3b3JkLmxlbmd0aCA+IDApIHsgbmV3VXNlckRhdGEucGFzc3dvcmQgPSAkc2NvcGUucGFzc3dvcmQ7IH1cclxuXHJcbiAgICBzdEF1dGgudXBkYXRlQ3VycmVudFVzZXIobmV3VXNlckRhdGEpLnRoZW4oXHJcbiAgICAgIGZ1bmN0aW9uKCkgeyBzdFRpY2tlclN2Yy5ub3RpZnkoJ1lvdXIgcHJvZmlsZSBoYXMgYmVlbiB1cGRhdGVkLicpIH0sIFxyXG4gICAgICBmdW5jdGlvbihyZWFzb24pIHsgc3RUaWNrZXJTdmMuZXJyb3IocmVhc29uKTsgfVxyXG4gICAgKTtcclxuICB9XHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmZhY3RvcnkoJ3N0VXNlcicsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xyXG4gIHZhciBVc2VyUmVzb3VyY2UgPSAkcmVzb3VyY2UoJy9hcGkvdXNlcnMvOmlkJywge19pZDogXCJAaWRcIn0sIHtcclxuICAgIHVwZGF0ZToge21ldGhvZDogJ1BVVCcsIGlzQXJyYXk6IGZhbHNlfSxcclxuICAgIHB1cmdlOiB7bWV0aG9kOiAnUFVSR0UnLCBpc0FycmF5OiBmYWxzZX1cclxuICB9KTtcclxuICBcclxuICBVc2VyUmVzb3VyY2UucHJvdG90eXBlLmlzQWRtaW4gPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLnJvbGVzICYmIHRoaXMucm9sZXMuaW5kZXhPZignYWRtaW4nKSA+IC0xO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gVXNlclJlc291cmNlO1xyXG59KSIsImFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmZhY3RvcnkoZnVuY3Rpb24oKSB7XHJcbiAgXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmNvbnRyb2xsZXIoJ3N0QWRtaW5DdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkZmlsdGVyLCAkbG9jYXRpb24sICR0aW1lb3V0LCAkcm9vdFNjb3BlLCBzdEF1dGgsIHN0VGlja2VyU3ZjLCBzdFVzZXIpIHtcclxuICAkc2NvcGUudXNlcnMgPSBzdFVzZXIucXVlcnkoKTtcclxuICAkc2NvcGUudXNlclJlcyA9ICRzY29wZS51c2VycztcclxuICAkc2NvcGUudXNlckZpZWxkID0gJ3VzZXJOYW1lJztcclxuICAkc2NvcGUudXNlclJldmVyc2UgPSBmYWxzZTtcclxuICAkc2NvcGUudXNlckN1cnJlbnRQYWdlID0gMDtcclxuICAkc2NvcGUudXNlclNob3dPblBhZ2UgPSAnMTAnO1xyXG4gICRzY29wZS51c2VyU3luY0VuYWJsZWQgPSB3aW5kb3cuZW52ID09ICdkZXZlbG9wbWVudCcgPyB0cnVlIDogZmFsc2U7XHJcbiAgJHNjb3BlLnVzZXJTeW5jRGlyID0gJ3RvbG9jJztcclxuXHJcbiAgJHNjb3BlLmZpbHRlclVzZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAkc2NvcGUudXNlclJlcyA9IFtdO1xyXG4gICAgdmFyIHJlcyA9ICRmaWx0ZXIoJ3VzZXJmaW5kJykoJHNjb3BlLnVzZXJzLCAkc2NvcGUudXNlclNlYXJjaCk7XHJcbiAgICAkc2NvcGUudXNlclJlcyA9IHJlcztcclxuICAgICRzY29wZS51c2VyQ3VycmVudFBhZ2UgPSAwO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnNvcnRVc2VycyA9IGZ1bmN0aW9uKGZpZWxkLCBpbnZlcnQpIHtcclxuICAgICRzY29wZS51c2VyUmV2ZXJzZSA9ICgkc2NvcGUudXNlckZpZWxkID09PSBmaWVsZCA/ICEkc2NvcGUudXNlclJldmVyc2UgOiBmYWxzZSk7XHJcbiAgICBpZihpbnZlcnQpIHsgJHNjb3BlLnVzZXJSZXZlcnNlID0gKCRzY29wZS51c2VyRmllbGQgPT09IGZpZWxkID8gJHNjb3BlLnVzZXJSZXZlcnNlIDogdHJ1ZSk7IH1cclxuICAgICRzY29wZS51c2VyRmllbGQgPSBmaWVsZDtcclxuICB9XHJcbiAgXHJcbiAgJHNjb3BlLmNyZWF0ZVVzZXIgPSBmdW5jdGlvbigpIHtcclxuICAgIHZhciBuZXdVc2VyRGF0YSA9IHtcclxuICAgICAgdXNlck5hbWU6ICRzY29wZS5lbWFpbCxcclxuICAgICAgcGFzc3dvcmQ6ICRzY29wZS5wYXNzd29yZCxcclxuICAgICAgZmlyc3ROYW1lOiAkc2NvcGUuZmlyc3ROYW1lLFxyXG4gICAgICBsYXN0TmFtZTogJHNjb3BlLmxhc3ROYW1lXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBzdEF1dGguY3JlYXRlVXNlcihuZXdVc2VyRGF0YSkudGhlbihcclxuICAgICAgZnVuY3Rpb24oKSB7IHN0VGlja2VyU3ZjLm5vdGlmeSgnQ3JlYXRlZCB1c2VyIGFjY291bnQgJyArIG5ld1VzZXJEYXRhLnVzZXJOYW1lICsgICcuJyk7ICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4nKTsgfSwgXHJcbiAgICAgIGZ1bmN0aW9uKHJlYXNvbikgeyBzdFRpY2tlclN2Yy5lcnJvcihyZWFzb24pOyB9XHJcbiAgICApO1xyXG4gIH1cclxuICBcclxuICAkc2NvcGUucHVyZ2VVc2VycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgJGxvY2F0aW9uLnBhdGgoJy9hZG1pbicpO1xyXG4gICAgJHJvb3RTY29wZS51c2VyUHVyZ2VJblByb2dyZXNzID0gdHJ1ZTtcclxuICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICBzdEF1dGgucHVyZ2VVc2VycygpLnRoZW4oXHJcbiAgICAgICAgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XHJcbiAgICAgICAgICAgIHN0QXV0aC5sb2dvdXRVc2VyKCkudGhlbihcclxuICAgICAgICAgICAgZnVuY3Rpb24oKSB7ICR0aW1lb3V0KCRzY29wZS5wdXJnZURvbmUsIDUwMDApOyB9LFxyXG4gICAgICAgICAgICBmdW5jdGlvbihyZWFzb24pIHsgXHJcbiAgICAgICAgICAgICAgc3RUaWNrZXJTdmMuZXJyb3IocmVhc29uKTtcclxuICAgICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXJQdXJnZUluUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9LCBcclxuICAgICAgICBmdW5jdGlvbihyZWFzb24pIHsgc3RUaWNrZXJTdmMuZXJyb3IocmVhc29uKTsgJHRpbWVvdXQoJHNjb3BlLnB1cmdlRG9uZSwgNTAwMCk7IH1cclxuICAgICAgKTtcclxuICAgIH0sIDUwMDApO1xyXG4gIH1cclxuICBcclxuICAkc2NvcGUuc3luY0RiID0gZnVuY3Rpb24oY29sbGVjdGlvbiwgc3luY0Rpcikge1xyXG4gICAgaWYoY29sbGVjdGlvbiA9PSAndXNlcnMnKSB7XHJcbiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYWRtaW4nKTtcclxuICAgICAgJHJvb3RTY29wZS51c2VyU3luY0luUHJvZ3Jlc3MgPSB0cnVlO1xyXG4gICAgICBzdEF1dGguc3luY1VzZXJzKHN5bmNEaXIpLnRoZW4oXHJcbiAgICAgICAgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBpZihzeW5jRGlyID09ICd0b2xvYycpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcclxuICAgICAgICAgICAgc3RBdXRoLmxvZ291dFVzZXIoKS50aGVuKFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKCkgeyAkdGltZW91dCgkc2NvcGUuc3luY0RvbmUsIDUwMDApOyB9LFxyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgc3RUaWNrZXJTdmMuZXJyb3IocmVhc29uKTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUudXNlclN5bmNJblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7ICR0aW1lb3V0KCRzY29wZS5zeW5jRG9uZSwgNTAwMCk7IH1cclxuICAgICAgIH0sXHJcbiAgICAgICAgZnVuY3Rpb24ocmVhc29uKSB7IHN0VGlja2VyU3ZjLmVycm9yKHJlYXNvbik7ICR0aW1lb3V0KCRzY29wZS5zeW5jRG9uZSwgNTAwMCk7IH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgJHNjb3BlLnBhZ2VVc2VycyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIE1hdGguY2VpbCgkc2NvcGUudXNlclJlcy5sZW5ndGgvJHNjb3BlLnVzZXJTaG93T25QYWdlKTtcclxuICB9XHJcbiAgXHJcbiAgJHNjb3BlLnB1cmdlRG9uZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgc3RUaWNrZXJTdmMubm90aWZ5KCdVc2VyIGRhdGFiYXNlIGhhcyBiZWVuIHB1cmdlZC4nKTsgXHJcbiAgICAkcm9vdFNjb3BlLnVzZXJQdXJnZUluUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICB9XHJcbiAgXHJcbiAgJHNjb3BlLnN5bmNEb25lID0gZnVuY3Rpb24oKSB7XHJcbiAgICBzdFRpY2tlclN2Yy5ub3RpZnkoJ1VzZXIgZGF0YWJhc2UgaGFzIGJlZW4gc3luY2VkLicpOyBcclxuICAgICRyb290U2NvcGUudXNlclN5bmNJblByb2dyZXNzID0gZmFsc2U7XHJcbiAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5maWx0ZXIoJ3VzZXJTdGFydFBhZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpIHtcclxuICAgICAgICBzdGFydCA9ICtzdGFydDtcclxuICAgICAgICByZXR1cm4gaW5wdXQuc2xpY2Uoc3RhcnQpO1xyXG4gICAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgnc3RhZ2UnKS5maWx0ZXIoJ3VzZXJmaW5kJywgZnVuY3Rpb24oKSB7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uKHVzZXJzLCBxKSB7XHJcbiAgICB2YXIgbWF0Y2hlZCA9IFtdO1xyXG4gICAgYW5ndWxhci5mb3JFYWNoKHVzZXJzLCBmdW5jdGlvbih1KSB7XHJcbiAgICAgIHRyeSB7IHZhciBleHAgPSBuZXcgUmVnRXhwKHEsICdnaScpOyB9IGNhdGNoKGUpIHsgcmV0dXJuIFtdOyB9XHJcbiAgICAgIGlmKHUudXNlck5hbWUubWF0Y2goZXhwKSB8fCB1LmZpcnN0TmFtZS5tYXRjaChleHApIHx8IHUubGFzdE5hbWUubWF0Y2goZXhwKSB8fCBxID09ICcnKSB7XHJcbiAgICAgICAgbWF0Y2hlZC5wdXNoKHtcclxuICAgICAgICAgIF9pZDogdS5faWQsIFxyXG4gICAgICAgICAgdXNlck5hbWU6IHUudXNlck5hbWUsIFxyXG4gICAgICAgICAgZmlyc3ROYW1lOiB1LmZpcnN0TmFtZSwgXHJcbiAgICAgICAgICBsYXN0TmFtZTogdS5sYXN0TmFtZSxcclxuICAgICAgICAgIHJvbGVzOiB1LnJvbGVzXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWF0Y2hlZDtcclxuICB9XHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmNvbnRyb2xsZXIoJ3N0TWFpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmNvbnRyb2xsZXIoJ3N0VGlja2VyQ3RybCcsIFsnJHNjb3BlJywgJ3N0VGlja2VyU3ZjJywgZnVuY3Rpb24oJHNjb3BlLCBzdFRpY2tlclN2Yykge1xyXG4gICRzY29wZS5jdXN0b20gPSBzdFRpY2tlclN2Yy5jdXN0b20oKTtcclxuICAkc2NvcGUucmVzZXQgPSBzdFRpY2tlclN2Yy5yZXNldCgpO1xyXG4gICRzY29wZS5zaG93QWxsID0gZnVuY3Rpb24oKSB7ICQoJy50aWNrZXItY29udGFpbmVyJykudG9nZ2xlQ2xhc3MoJ2V4cGFuZGVkJyk7IH1cclxufV0pOyIsImFuZ3VsYXIubW9kdWxlKCdzdGFnZScpLmZhY3RvcnkoJ3N0VGlja2VyU3ZjJywgZnVuY3Rpb24oKSB7XHJcbiAgdmFyIGZ0ciA9ICcvL3RhcmRpZ3JhZGUvbm9kZSB8IFRhcmRpZ3JhZGUgRGlnaXRhbCAmY29weTsgMjAxNic7XHJcbiAgdmFyIHRvc2V0ID0gZmFsc2U7XHJcbiAgdmFyIHRvID0gbnVsbDtcclxuICBcclxuICBmdW5jdGlvbiBhZGRUaWNrZXIobXNnLCBsdmwsIGljKSB7XHJcbiAgICBtc2cgPSBsdmwgPyAoJyAnICsgbXNnKSA6IG1zZztcclxuICAgIHZhciBtc2dvYmogPSAkKCc8c3Bhbj48L3NwYW4+JykuYWRkQ2xhc3MoJ3RpY2tlci1tc2cnKS5odG1sKG1zZyk7XHJcbiAgICBpZihpYykgeyBcclxuICAgICAgaWMgPSAkKCc8c3Bhbj48L3NwYW4+JykuYWRkQ2xhc3MoJ2ljb25pYyBpY29uaWMtc20gJyArIGljKTsgXHJcbiAgICAgIG1zZ29iai5wcmVwZW5kKGljKTsgXHJcbiAgICB9XHJcbiAgICBpZihsdmwpIHsgbXNnb2JqLmFkZENsYXNzKGx2bCk7IH1cclxuICAgICQoJyN0aWNrZXInKS5hZGRDbGFzcygnb24nKS5wcmVwZW5kKG1zZ29iaik7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyQoJyN0aWNrZXInKS5yZW1vdmVDbGFzcygnb24nKTt9LCAzMDApO1xyXG4gICAgaWYoIXRvc2V0KSB7IHRvc2V0ID0gdHJ1ZTsgdG8gPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyByZXNldFRpY2tlcigpOyB0b3NldCA9IGZhbHNlOyB9LCA4MDAwKTsgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIGNsZWFyVGltZW91dCh0byk7XHJcbiAgICAgIHRvID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsgcmVzZXRUaWNrZXIoKTsgdG9zZXQgPSBmYWxzZTsgfSwgODAwMCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIGZ1bmN0aW9uIHJlc2V0VGlja2VyKCkge1xyXG4gICAgJCgnI3RpY2tlciAjZnRybXNnJykucmVtb3ZlKCk7XHJcbiAgICB2YXIgbXNnb2JqID0gJCgnPHNwYW4+PC9zcGFuPicpLmh0bWwoZnRyKS5hdHRyKCdpZCcsICdmdHJtc2cnKTtcclxuICAgICQoJyN0aWNrZXInKS5hZGRDbGFzcygnb24nKS5wcmVwZW5kKG1zZ29iaik7XHJcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyQoJyN0aWNrZXInKS5yZW1vdmVDbGFzcygnb24nKTt9LCAzMDApO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4ge1xyXG4gICAgY3VzdG9tOiBmdW5jdGlvbihtc2csIGx2bCwgaWMpIHsgaWYoIW1zZykgeyByZXR1cm4gZmFsc2U7IH07IGFkZFRpY2tlcihtc2csIGx2bCwgKCdpY29uaWMtJyArIGljKSk7IH0sXHJcbiAgICBub3RpZnk6IGZ1bmN0aW9uKG1zZykgeyBpZighbXNnKSB7IHJldHVybiBmYWxzZTsgfTsgYWRkVGlja2VyKG1zZywgJ3N1Y2Nlc3MnLCAnaWNvbmljLWNpcmNsZS1jaGVjaycpOyB9LFxyXG4gICAgZXJyb3I6IGZ1bmN0aW9uKG1zZykgeyBpZighbXNnKSB7IHJldHVybiBmYWxzZTsgfTsgYWRkVGlja2VyKG1zZywgJ2Vycm9yJywgJ2ljb25pYy1jaXJjbGUteCcpOyB9LFxyXG4gICAgaW5mbzogZnVuY3Rpb24obXNnKSB7IGlmKCFtc2cpIHsgcmV0dXJuIGZhbHNlOyB9OyBhZGRUaWNrZXIobXNnLCBudWxsLCAnaWNvbmljLWluZm8nKTsgfSxcclxuICAgIHJlc2V0OiBmdW5jdGlvbigpIHsgcmVzZXRUaWNrZXIoKTsgfVxyXG4gIH1cclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
